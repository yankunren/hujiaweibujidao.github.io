
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Gradle Plugin for Android Development User Guide (2) - Hujiawei Bujidao</title>
  <meta name="author" content="hujiawei">

  
  <meta name="description" content="Gradle Plugin for Android Development User Guide (2) 阅读本文前请先阅读第一部分：http://hujiaweibujidao.github.io/blog/2014/10/15/gradle-plugin-user-guide-1 原文地址： &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hujiaweibujidao.github.io/blog/2014/10/15/gradle-plugin-user-guide-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hujiawei Bujidao" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  -->
  <script type='text/javascript' src='http://ajax.useso.com/ajax/libs/jquery/1.7.2/jquery.min.js?ver=3.4.2'></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
<link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <!--
  

  -->
</head>

<body   >

	<header role="banner">
		
<hgroup style="text-align: center">
	<h1><a href="/"><img src="/images/conan-paper-small.png"  />Hujiawei Bujidao<img src="/images/conan-hat-small.png"  /></a></h1>
	
	<h2>I will always be your savior! A secret makes a man man!</h2>
	
</hgroup>


	</header>
	<nav role="navigation">
		<ul class="subscription" data-subscription="rss">
  <!--<li><a href="https://github.com/hujiaweibujidao" rel="subscribe-rss" title="subscribe via RSS">View me on GitHub</a></li>-->
  
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
  <!--
  
  --> 
</ul>
<!--
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hujiaweibujidao.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form> 
  
-->
<ul class="main-navigation">
  <li><a href="/blog/archives/">Blog</a></li>
  <li><a href="/aboutme/">AboutMe</a></li>
  <li><a href="/math/">Math</a></li>
  <li><a href="/python/">Python</a></li>
  <li><a href="/mobile/">Mobile</a></li>
  
  <li><a href="/blog/categories/algorithm/">Algorithms</a></li>
  <!--
  <li><a href="/blog/categories/mobiledev/">MobileDev</a></li>
  <li><a href="/datamining/">ML-DM-PR</a></li>
  -->
  <li><a href="/blog/categories/music/">Music</a></li>
  <li><a href="/blog/categories/picture/">Picture</a></li>
  <!--
  <li><a href="/xjava/">XJava</a></li>
  -->
  <!-- <li><a href="/datamining/">Projects</a></li> -->
</ul>


	</nav>
	<div id="main">
		<div id="content">
			<div>

<article class="hentry" role="article">
		
  <header>
    
      <h1 class="entry-title">Gradle Plugin for Android Development User Guide (2)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-15T12:00:00+08:00" pubdate data-updated="true">Oct 15<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Gradle Plugin for Android Development User Guide (2)</p>

<p>阅读本文前请先阅读第一部分：<a href="http://hujiaweibujidao.github.io/blog/2014/10/15/gradle-plugin-user-guide-1/">http://hujiaweibujidao.github.io/blog/2014/10/15/gradle-plugin-user-guide-1</a></p>

<p>原文地址：<a href="http://tools.android.com/tech-docs/new-build-system/user-guide">http://tools.android.com/tech-docs/new-build-system/user-guide</a></p>

<h3 id="testing">Testing</h3>

<p>[现在我们可以直接将test application集成到我们的application project中，没有必要再创建一个独立的test project了]</p>

<p>Building a test application is integrated into the application project. There is no need for a separate test project anymore.</p>

<h4 id="basics-and-configuration">Basics and Configuration</h4>

<p>[测试代码默认存放在<code>src/androidTest/</code> 目录下，使用Android Testing Framework 我们可以创建unit tests，instrumentation tests, 和 uiautomator tests.]</p>

<p>As mentioned previously, next to the <code>main</code> sourceSet is the <code>androidTest</code> sourceSet, located by default in <code>src/androidTest/</code></p>

<p>From this sourceSet is built a test apk that can be deployed to a device to test the application using the <code>Android testing framework</code>. This can contain unit tests, instrumentation tests, and later uiautomator tests.</p>

<p>[test app的<code>AndroidManifest.xml</code> 文件是自动生成的，所以它不需要指定位置，此外，我们没必要设置test application的instrumentation节点的<code>targetPackage</code> 属性，因为它会被test app的package name填充进去，这也就是为什么test app的Manifest文件是自动生成的]</p>

<p>The sourceSet should not contain an <code>AndroidManifest.xml</code> as it is automatically generated.</p>

<p>There are a few values that can be configured for the test app: [test app可以指定的属性]</p>

<p><code>testPackageName</code>     <br />
<code>testInstrumentationRunner</code>      <br />
<code>testHandleProfiling</code>      <br />
<code>testFunctionalTest</code>         </p>

<p>As seen previously, those are configured in the defaultConfig object:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">defaultConfig</span> <span class="o">{</span>
</span><span class="line">        <span class="n">testPackageName</span> <span class="s">&quot;com.test.foo&quot;</span>
</span><span class="line">        <span class="n">testInstrumentationRunner</span> <span class="s">&quot;android.test.InstrumentationTestRunner&quot;</span>
</span><span class="line">        <span class="n">testHandleProfiling</span> <span class="kc">true</span>
</span><span class="line">        <span class="n">testFunctionalTest</span> <span class="kc">true</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>The value of the <code>targetPackage</code> attribute of the instrumentation node in the test application manifest is automatically filled with the package name of the tested app, even if it is customized through the <code>defaultConfig</code> and/or the Build Type objects. This is one of the reason the manifest is generated automatically.</strong></p>

<p>Additionally, the sourceSet can be configured to have its own dependencies.
By default, the application and its own dependencies are added to the test app classpath, but this can be extended with </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">dependencies</span> <span class="o">{</span>
</span><span class="line">    <span class="n">androidTestCompile</span> <span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">google</span><span class="o">.</span><span class="na">guava</span><span class="o">:</span><span class="nl">guava:</span><span class="mf">11.0</span><span class="o">.</span><span class="mi">2</span><span class="err">&#39;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>[test app是通过任务<code>assembleTest</code> 来构建的，它不是main assemble任务的依赖项，所以它是在test运行时自动调用的。目前只有debug这个build type会被测试，当然也可以自定义]</p>

<p><strong>The test app is built by the task <code>assembleTest</code>. It is not a dependency of the main assemble task, and is instead called automatically when the tests are set to run.</strong></p>

<p><strong>Currently only one Build Type is tested. By default it is the <code>debug</code> Build Type, but this can be reconfigured with:</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line">    <span class="n">testBuildType</span> <span class="s">&quot;staging&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="running-tests">Running tests</h4>

<p>[前面提到过，在所有已连接的设备上进行check的任务是<code>connectedCheck</code>，它依赖任务<code>androidTest</code>，该任务的工作是并行地在所有已连接的设备上运行测试，任何一个设备测试失败的话，build就会失败。测试的结果会保存在XML文件中，存放在<code>build/androidTest-results</code> 目录下，当然也可以修改目标目录]</p>

<p>As mentioned previously, checks requiring a connected device are launched with the anchor task called <code>connectedCheck</code>.</p>

<p>This depends on the task <code>androidTest</code> and therefore will run it. This task does the following:  [<code>androidTest</code> 任务的工作流程]</p>

<p>1 Ensure the app and the test app are built (depending on <code>assembleDebug</code> and <code>assembleTest</code>)  <br />
2 Install both apps    <br />
3 Run the tests     <br />
4 Uninstall both apps.      </p>

<p>If more than one device is connected, all tests are run in parallel on all connected devices. If one of the test fails, on any device, the build will fail.</p>

<p>All test results are stored as XML files under</p>

<p><code>build/androidTest-results</code></p>

<p>(This is similar to regular jUnit results that are stored under <code>build/test-results</code>)</p>

<p>This can be configured with</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line">
</span><span class="line">    <span class="n">testOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="n">resultsDir</span> <span class="o">=</span> <span class="s">&quot;$project.buildDir/foo/results&quot;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>The value of <code>android.testOptions.resultsDir</code> is evaluated with <code>Project.file(String)</code></strong></p>

<h4 id="testing-android-libraries">Testing Android Libraries</h4>

<p>[测试android library project和测试一般的application差不多，区别在于整个library和它的依赖项都会被自动添加到test app，Manifest文件也被整合到test app的Manifest中。此外，<code>androidTest</code> 任务只能安装和卸载test APK]</p>

<p>Testing Android Library project is done exactly the same way as application projects.</p>

<p>The only difference is that the whole library (and its dependencies) is automatically added as a Library dependency to the test app. The result is that the test APK includes not only its own code, but also the library itself and all its dependencies.</p>

<p>The manifest of the Library is merged into the manifest of the test app (as is the case for any project referencing this Library).</p>

<p>The <code>androidTest</code> task is changed to only install (and uninstall) the test APK (since there are no other APK to install.)</p>

<p>Everything else is identical.</p>

<h4 id="test-reports">Test reports</h4>

<p>[在进行单元测试时，Gradle会输出一份HTML文档形式的报告。Android插件在此之上进行扩展，输出一份整合了所有已连接设备的测试结果的测试报告]</p>

<p>When running unit tests, Gradle outputs an HTML report to easily look at the results.</p>

<p>The Android plugins build on this and extends the HTML report to aggregate the results from all connected devices.</p>

<h4 id="single-projects">Single projects</h4>

<p>The project is automatically generated upon running the tests. Its default location is <code>build/reports/androidTests</code></p>

<p>This is similar to the jUnit report location, which is <code>build/reports/tests</code>, or other reports usually located in <code>build/reports/&lt;plugin&gt;/</code></p>

<p>The location can be customized with</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line">
</span><span class="line">    <span class="n">testOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="n">reportDir</span> <span class="o">=</span> <span class="s">&quot;$project.buildDir/foo/report&quot;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The report will aggregate tests that ran on different devices.</p>

<h4 id="multi-projects-reports">Multi-projects reports</h4>

<p>[对于多项目的测试，可以使用插件<code>android-reporting</code> 来将所有的测试结果输出到一个单一的报告中，而且这个设置必须是要设置在根项目的<code>build.gradle</code> 文件中]</p>

<p>In a multi project setup with application(s) and library(ies) projects, when running all tests at the same time, it might be useful to generate a single reports for all tests.</p>

<p>To do this, a different plugin is available in the same artifact. It can be applied with:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">buildscript</span> <span class="o">{</span>
</span><span class="line">    <span class="n">repositories</span> <span class="o">{</span>
</span><span class="line">        <span class="n">mavenCentral</span><span class="o">()</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">dependencies</span> <span class="o">{</span>
</span><span class="line">        <span class="n">classpath</span> <span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">tools</span><span class="o">.</span><span class="na">build</span><span class="o">:</span><span class="nl">gradle:</span><span class="mf">0.5</span><span class="o">.</span><span class="mi">6</span><span class="err">&#39;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="n">apply</span> <span class="nl">plugin:</span> <span class="err">&#39;</span><span class="n">android</span><span class="o">-</span><span class="n">reporting</span><span class="err">&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This should be applied to the root project, ie in <code>build.gradle</code> next to <code>settings.gradle</code></p>

<p>[在项目根目录下使用下面的命令可以保证运行所有的测试并聚合所有的测试结果，其中的<code>--continue</code> 选项能够保证即使某个设备在测试过程中出现了问题也不会打断其他的设备继续测试]</p>

<p>Then from the root folder, the following command line will run all the tests and aggregate the reports:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">gradle</span> <span class="n">deviceCheck</span> <span class="n">mergeAndroidReports</span> <span class="o">--</span><span class="k">continue</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note: the <code>--continue</code> option ensure that all tests, from all sub-projects will be run even if one of them fails. Without it the first failing test will interrupt the run and not all projects may have their tests run.</p>

<h4 id="lint-support">Lint support</h4>

<p>[lint可以指出程序中可能出现的issue，android插件同样支持]</p>

<p>As of version 0.7.0, you can run lint for a specific variant, or for all variants, in which case it produces a report which describes which specific variants a given issue applies to.</p>

<p>You can configure lint by adding a <code>lintOptions</code> section like following. You typically only specify a few of these; this section shows all the available options.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">lintOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="c1">// set to true to turn off analysis progress reporting by lint</span>
</span><span class="line">        <span class="n">quiet</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// if true, stop the gradle build if errors are found</span>
</span><span class="line">        <span class="n">abortOnError</span> <span class="kc">false</span>
</span><span class="line">        <span class="c1">// if true, only report errors</span>
</span><span class="line">        <span class="n">ignoreWarnings</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// if true, emit full/absolute paths to files with errors (true by default)</span>
</span><span class="line">        <span class="c1">//absolutePaths true</span>
</span><span class="line">        <span class="c1">// if true, check all issues, including those that are off by default</span>
</span><span class="line">        <span class="n">checkAllWarnings</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// if true, treat all warnings as errors</span>
</span><span class="line">        <span class="n">warningsAsErrors</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// turn off checking the given issue id&#39;s</span>
</span><span class="line">        <span class="n">disable</span> <span class="err">&#39;</span><span class="n">TypographyFractions</span><span class="sc">&#39;,&#39;</span><span class="n">TypographyQuotes</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// turn on the given issue id&#39;s</span>
</span><span class="line">        <span class="n">enable</span> <span class="err">&#39;</span><span class="n">RtlHardcoded</span><span class="sc">&#39;,&#39;</span><span class="n">RtlCompat</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">RtlEnabled</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// check *only* the given issue id&#39;s</span>
</span><span class="line">        <span class="n">check</span> <span class="err">&#39;</span><span class="n">NewApi</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">InlinedApi</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// if true, don&#39;t include source code lines in the error output</span>
</span><span class="line">        <span class="n">noLines</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// if true, show all locations for an error, do not truncate lists, etc.</span>
</span><span class="line">        <span class="n">showAll</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// Fallback lint configuration (default severities, etc.)</span>
</span><span class="line">        <span class="n">lintConfig</span> <span class="nf">file</span><span class="o">(</span><span class="s">&quot;default-lint.xml&quot;</span><span class="o">)</span>
</span><span class="line">        <span class="c1">// if true, generate a text report of issues (false by default)</span>
</span><span class="line">        <span class="n">textReport</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// location to write the output; can be a file or &#39;stdout&#39;</span>
</span><span class="line">        <span class="n">textOutput</span> <span class="err">&#39;</span><span class="n">stdout</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// if true, generate an XML report for use by for example Jenkins</span>
</span><span class="line">        <span class="n">xmlReport</span> <span class="kc">false</span>
</span><span class="line">        <span class="c1">// file to write report to (if not specified, defaults to lint-results.xml)</span>
</span><span class="line">        <span class="n">xmlOutput</span> <span class="nf">file</span><span class="o">(</span><span class="s">&quot;lint-report.xml&quot;</span><span class="o">)</span>
</span><span class="line">        <span class="c1">// if true, generate an HTML report (with issue explanations, sourcecode, etc)</span>
</span><span class="line">        <span class="n">htmlReport</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// optional path to report (default will be lint-results.html in the builddir)</span>
</span><span class="line">        <span class="n">htmlOutput</span> <span class="nf">file</span><span class="o">(</span><span class="s">&quot;lint-report.html&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">   <span class="c1">// set to true to have all release builds run lint on issues with severity=fatal</span>
</span><span class="line">   <span class="c1">// and abort the build (controlled by abortOnError above) if fatal issues are found</span>
</span><span class="line">   <span class="n">checkReleaseBuilds</span> <span class="kc">true</span>
</span><span class="line">        <span class="c1">// Set the severity of the given issues to fatal (which means they will be</span>
</span><span class="line">        <span class="c1">// checked during release builds (even if the lint target is not included)</span>
</span><span class="line">        <span class="n">fatal</span> <span class="err">&#39;</span><span class="n">NewApi</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">InlineApi</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// Set the severity of the given issues to error</span>
</span><span class="line">        <span class="n">error</span> <span class="err">&#39;</span><span class="n">Wakelock</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">TextViewEdits</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// Set the severity of the given issues to warning</span>
</span><span class="line">        <span class="n">warning</span> <span class="err">&#39;</span><span class="n">ResourceAsColor</span><span class="err">&#39;</span>
</span><span class="line">        <span class="c1">// Set the severity of the given issues to ignore (same as disabling the check)</span>
</span><span class="line">        <span class="n">ignore</span> <span class="err">&#39;</span><span class="n">TypographyQuotes</span><span class="err">&#39;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="build-variants">Build Variants</h3>

<p>One goal of the new build system is to enable creating different versions of the same application.</p>

<p>There are two main use cases: [同一套程序代码生成多种不同的结果的应用场景]</p>

<p>(1) Different versions of the same application</p>

<p>For instance, a free/demo version vs the “pro” paid application. [一个是展示应用，另一个是真正的付费应用]</p>

<p>Same application packaged differently for multi-apk in Google Play Store.
See <a href="http://developer.android.com/google/play/publishing/multiple-apks.html">http://developer.android.com/google/play/publishing/multiple-apks.html </a> for more information.</p>

<p>(2) A combination of 1. and 2. </p>

<p>The goal was to be able to generate these different APKs from the same project, as opposed to using a single Library Projects and 2+ Application Projects.</p>

<h4 id="product-flavors">Product flavors</h4>

<p>[product flavor是一个项目的特别定制版的应用程序输出，单个项目可以有很多不同的product flavors，它们的名称不要和build type和sourceSet的名称相同]</p>

<p>A product flavor defines a customized version of the application build by the project. A single project can have different flavors which change the generated application.</p>

<p><strong>This new concept is designed to help when the differences are very minimum. If the answer to “Is this the same application?” is yes, then this is probably the way to go over Library Projects.</strong></p>

<p>Product flavors are declared using a productFlavors DSL container:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="o">....</span>
</span><span class="line">
</span><span class="line">    <span class="n">productFlavors</span> <span class="o">{</span>
</span><span class="line">        <span class="n">flavor1</span> <span class="o">{</span>
</span><span class="line">            <span class="o">...</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="n">flavor2</span> <span class="o">{</span>
</span><span class="line">            <span class="o">...</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This creates two flavors, called flavor1 and flavor2.</p>

<p>Note: The name of the flavors cannot collide with existing Build Type names, or with the <code>androidTest</code> sourceSet.</p>

<p>[重要的式子：每个build type和product flavor的组合就是一个build variant]</p>

<p><strong>Build Type + Product Flavor = Build Variant</strong>  </p>

<p>As we have seen before, each Build Type generates a new APK.</p>

<p>Product Flavors do the same: the output of the project becomes all possible combinations of Build Types and, if applicable, Product Flavors.</p>

<p><strong>Each (Build Type, Product Flavor) combination is called a Build Variant.</strong></p>

<p>For instance, with the default <code>debug</code> and <code>release</code> Build Types, the above example generates four Build Variants:</p>

<p><code>Flavor1 - debug</code>    <br />
<code>Flavor1 - release</code>    <br />
<code>Flavor2 - debug</code>    <br />
<code>Flavor2 - release</code>      </p>

<p>[没有配置flavor的项目会有一个默认的flavor配置]</p>

<p>Projects with no flavors still have Build Variants, but the single default <code>flavor/config</code> is used, nameless, making the list of variants similar to the list of Build Types.</p>

<h4 id="product-flavor-configuration">Product Flavor Configuration</h4>

<p>Each flavors is configured with a closure:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line">
</span><span class="line">    <span class="n">defaultConfig</span> <span class="o">{</span>
</span><span class="line">        <span class="n">minSdkVersion</span> <span class="mi">8</span>
</span><span class="line">        <span class="n">versionCode</span> <span class="mi">10</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">productFlavors</span> <span class="o">{</span>
</span><span class="line">        <span class="n">flavor1</span> <span class="o">{</span>
</span><span class="line">            <span class="n">packageName</span> <span class="s">&quot;com.example.flavor1&quot;</span>
</span><span class="line">            <span class="n">versionCode</span> <span class="mi">20</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="n">flavor2</span> <span class="o">{</span>
</span><span class="line">            <span class="n">packageName</span> <span class="s">&quot;com.example.flavor2&quot;</span>
</span><span class="line">            <span class="n">minSdkVersion</span> <span class="mi">14</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>[ProductFlavor对象和<code>android.defaultConfig</code> 对象有相同的属性，即可以使用类似的配置方式]</p>

<p><strong>Note that the <code>android.productFlavors.*</code> objects are of type <code>ProductFlavor</code> which is the same type as the <code>android.defaultConfig</code> object. This means they share the same properties.</strong></p>

<p><code>defaultConfig</code> provides the base configuration for all flavors and each flavor can override any value. In the example above, the configurations end up being:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">flavor1</span>
</span><span class="line"><span class="nl">packageName:</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">flavor1</span>
</span><span class="line"><span class="nl">minSdkVersion:</span> <span class="mi">8</span>
</span><span class="line"><span class="nl">versionCode:</span> <span class="mi">20</span>
</span><span class="line">
</span><span class="line"><span class="n">flavor2</span>
</span><span class="line"><span class="nl">packageName:</span> <span class="n">com</span><span class="o">.</span><span class="na">example</span><span class="o">.</span><span class="na">flavor2</span>
</span><span class="line"><span class="nl">minSdkVersion:</span> <span class="mi">14</span>
</span><span class="line"><span class="nl">versionCode:</span> <span class="mi">10</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Usually, the Build Type configuration is an overlay over the other configuration. For instance, the Build Type’s packageNameSuffix is appended to the Product Flavor’s packageName.</p>

<p>[有些情况下，我们希望一个设置同时作用在build type和product flavor上，例如<code>signingConfig</code> 就是其中的一种配置，我们既可以设置所有的build type使用相同的SigningConfig，又可以设置某些flavor使用某个特定的SigningConfig]</p>

<p>There are cases where a setting is settable on both the Build Type and the Product Flavor. In this case, it’s is on a case by case basis.</p>

<p>For instance, <code>signingConfig</code> is one of these properties.</p>

<p>This enables either having all release packages share the same <code>SigningConfig</code>, by setting <code>android.buildTypes.release.signingConfig</code>, or have each release package use their own SigningConfig by setting each <code>android.productFlavors.*.signingConfig</code> objects separately.</p>

<h4 id="sourcesets-and-dependencies">Sourcesets and Dependencies</h4>

<p>[和build type类似，product flavor也会产生自己的sourceSets，这些sourceSets和build type的sourceSets以及<code>android.sourceSets.main</code> 组合起来构建最终的APK]</p>

<p>Similar to Build Types, Product Flavors also contribute code and resources through their own sourceSets.</p>

<p>The above example creates four sourceSets:</p>

<p><code>android.sourceSets.flavor1</code>   Location <code>src/flavor1/</code>      <br />
<code>android.sourceSets.flavor2</code>   Location <code>src/flavor2/</code>     <br />
<code>android.sourceSets.androidTestFlavor1</code>   Location <code>src/androidTestFlavor1/</code>    <br />
<code>android.sourceSets.androidTestFlavor2</code>   Location <code>src/androidTestFlavor2/</code>     </p>

<p>Those sourceSets are used to build the APK, alongside <code>android.sourceSets.main</code> and the Build Type sourceSet.</p>

<p>The following rules are used when dealing with all the sourcesets used to build a single APK:  <strong>[重点：在构建APK过程中处理所有源码和资源的规则]</strong></p>

<p>1 All source code (<code>src/*/java</code>) are used together as multiple folders generating a single output.  [所有的源代码都会整合到一起作为输出]</p>

<p>2 Manifests are all merged together into a single manifest. This allows Product Flavors to have different components and/or permissions, similarly to Build Types.  [所有的Manifest文件也都会整合成为一个Manifest文件，其中product flavor和build type类似，都可以有不同的components或者permissions]</p>

<p>3 <strong>All resources (Android <code>res</code> and <code>assets</code>) are used using overlay priority where the Build Type overrides the Product Flavor, which overrides the main sourceSet. ** [所有的资源文件按照优先级的不同采用覆盖的方式整合，product flavor覆盖main，build type覆盖product flavor]  **[?这里的优先级总觉得有点问题?]</strong></p>

<p>4 Each Build Variant generates its own <code>R</code> class (or other generated source code) from the resources. Nothing is shared between variants. [每个Build Variant都会根据它的资源文件产生一个R清单类，并且在variants之间不进行共享]</p>

<p>5 Finally, like Build Types, Product Flavors can have their own dependencies. For instance, if the flavors are used to generate a ads-based app and a paid app, one of the flavors could have a dependency on an Ads SDK, while the other does not. [最后，build type和product flavor一样都可以有自己的依赖项]</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">dependencies</span> <span class="o">{</span>
</span><span class="line">    <span class="n">flavor1Compile</span> <span class="s">&quot;...&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In this particular case, the file <code>src/flavor1/AndroidManifest.xml</code> would probably need to include the internet permission.</p>

<p>Additional sourcesets are also created for each variants:</p>

<p><code>android.sourceSets.flavor1Debug</code>   Location <code>src/flavor1Debug/</code>   <br />
<code>android.sourceSets.flavor1Release</code>   Location <code>src/flavor1Release/</code>    <br />
<code>android.sourceSets.flavor2Debug</code>    Location <code>src/flavor2Debug/</code>  <br />
<code>android.sourceSets.flavor2Release</code>    Location <code>src/flavor2Release/</code>     </p>

<p>These have higher priority than the build type sourcesets, and allow customization at the variant level.</p>

<p>[这些sourceSets的优先级比build type的sourceSets高，而且可以在variant层进行自定义]</p>

<h4 id="building-and-tasks">Building and Tasks</h4>

<p>We previously saw that each Build Type creates its own <code>assemble&lt;name&gt;</code> task, but that Build Variants are a combination of Build Type and Product Flavor.</p>

<p>[当一个product flavor被使用时，更多的assemble类型的任务会被创建，它们分别针对了特定的variant或者build type或者flavor]</p>

<p>When Product Flavors are used, more assemble-type tasks are created. These are:  </p>

<p><code>assemble&lt;Variant Name&gt;</code>    <br />
<code>assemble&lt;Build Type Name&gt;</code>        <br />
<code>assemble&lt;Product Flavor Name&gt;</code>        </p>

<p>1 allows directly building a <code>single variant</code>. For instance <code>assembleFlavor1Debug</code>.</p>

<p>2 allows building all APKs for a given <code>Build Type</code>. For instance <code>assembleDebug </code>will build both <code>Flavor1Debug</code> and <code>Flavor2Debug</code> variants.</p>

<p>3 allows building all APKs for a given <code>flavor</code>. For instance <code>assembleFlavor1</code> will build both <code>Flavor1Debug</code> and <code>Flavor1Release</code> variants.</p>

<p>The task <code>assemble</code> will build all possible variants.</p>

<h4 id="testing-1">Testing</h4>

<p>[测试包含多个<code>flavor</code> 的项目]</p>

<p>Testing multi-flavors project is very similar to simpler projects.</p>

<p>The <code>androidTest</code> sourceset is used for common tests across all flavors, while each flavor can also have its own tests.</p>

<p>As mentioned above, sourceSets to test each flavor are created:</p>

<p><code>android.sourceSets.androidTestFlavor1</code>    Location <code>src/androidTestFlavor1/</code>       <br />
<code>android.sourceSets.androidTestFlavor2</code>    Location <code>src/androidTestFlavor2/</code>      </p>

<p>Similarly, those can have their own dependencies:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">dependencies</span> <span class="o">{</span>
</span><span class="line">    <span class="n">androidTestFlavor1Compile</span> <span class="s">&quot;...&quot;</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Running the tests can be done through the main <code>deviceCheck</code> anchor task, or the main <code>androidTest</code> tasks which acts as an anchor task when flavors are used.</p>

<p>Each flavor has its own task to run <code>tests: androidTest&lt;VariantName&gt;</code>. For instance:</p>

<p><code>androidTestFlavor1Debug</code>           <br />
<code>androidTestFlavor2Debug</code>           </p>

<p>Similarly, test APK building tasks and install/uninstall tasks are per variant:</p>

<p><code>assembleFlavor1Test</code>      <br />
<code>installFlavor1Debug</code>      <br />
<code>installFlavor1Test</code>      <br />
<code>uninstallFlavor1Debug</code>      <br />
…</p>

<p>Finally the HTML report generation supports aggregation by flavor.
The location of the test results and reports is as follows, first for the per flavor version, and then for the aggregated one:</p>

<p><code>build/androidTest-results/flavors/&lt;FlavorName&gt;</code>      <br />
<code>build/androidTest-results/all/</code>      <br />
<code>build/reports/androidTests/flavors&lt;FlavorName&gt;</code>      <br />
<code>build/reports/androidTests/all/</code>        </p>

<p>Customizing either path, will only change the root folder and still create sub folders per-flavor and aggregated <code>results/reports</code>.</p>

<h4 id="multi-flavor-variants">Multi-flavor variants</h4>

<p>[使用<code>flavorGroups</code>，此处有些复杂，如果有这种需求请细读原文]</p>

<p>In some case, one may want to create several versions of the same apps based on more than one criteria.</p>

<p>For instance, multi-apk support in Google Play supports 4 different filters. </p>

<p>Creating different APKs split on each filter requires being able to use more than one dimension of Product Flavors.</p>

<p>Consider the example of a game that has a demo and a paid version and wants to use the ABI filter in the multi-apk support. With 3 ABIs and two versions of the application, 6 APKs needs to be generated (not counting the variants introduced by the different Build Types).</p>

<p>However, the code of the paid version is the same for all three ABIs, so creating simply 6 flavors is not the way to go.Instead, there are two dimensions of flavors, and variants should automatically build all possible combinations.</p>

<p>This feature is implemented using Flavor Groups. Each group represents a dimension, and flavors are assigned to a specific group.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line">
</span><span class="line">    <span class="n">flavorGroups</span> <span class="s">&quot;abi&quot;</span><span class="o">,</span> <span class="s">&quot;version&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">productFlavors</span> <span class="o">{</span>
</span><span class="line">        <span class="n">freeapp</span> <span class="o">{</span>
</span><span class="line">            <span class="n">flavorGroup</span> <span class="s">&quot;version&quot;</span>
</span><span class="line">            <span class="o">...</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">
</span><span class="line">        <span class="n">x86</span> <span class="o">{</span>
</span><span class="line">            <span class="n">flavorGroup</span> <span class="s">&quot;abi&quot;</span>
</span><span class="line">            <span class="o">...</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The <code>android.flavorGroups</code> array defines the possible groups, as well as the order. Each defined Product Flavor is assigned to a group.</p>

<p>From the following grouped Product Flavors <code>[freeapp, paidapp]</code> and <code>[x86, arm, mips]</code> and the <code>[debug, release]</code> Build Types, the following build variants will be created:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">x86</span><span class="o">-</span><span class="n">freeapp</span><span class="o">-</span><span class="n">debug</span>
</span><span class="line"><span class="n">x86</span><span class="o">-</span><span class="n">freeapp</span><span class="o">-</span><span class="n">release</span>
</span><span class="line"><span class="n">arm</span><span class="o">-</span><span class="n">freeapp</span><span class="o">-</span><span class="n">debug</span>
</span><span class="line"><span class="n">arm</span><span class="o">-</span><span class="n">freeapp</span><span class="o">-</span><span class="n">release</span>
</span><span class="line"><span class="n">mips</span><span class="o">-</span><span class="n">freeapp</span><span class="o">-</span><span class="n">debug</span>
</span><span class="line"><span class="n">mips</span><span class="o">-</span><span class="n">freeapp</span><span class="o">-</span><span class="n">release</span>
</span><span class="line"><span class="n">x86</span><span class="o">-</span><span class="n">paidapp</span><span class="o">-</span><span class="n">debug</span>
</span><span class="line"><span class="n">x86</span><span class="o">-</span><span class="n">paidapp</span><span class="o">-</span><span class="n">release</span>
</span><span class="line"><span class="n">arm</span><span class="o">-</span><span class="n">paidapp</span><span class="o">-</span><span class="n">debug</span>
</span><span class="line"><span class="n">arm</span><span class="o">-</span><span class="n">paidapp</span><span class="o">-</span><span class="n">release</span>
</span><span class="line"><span class="n">mips</span><span class="o">-</span><span class="n">paidapp</span><span class="o">-</span><span class="n">debug</span>
</span><span class="line"><span class="n">mips</span><span class="o">-</span><span class="n">paidapp</span><span class="o">-</span><span class="n">release</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The order of the group as defined by <code>android.flavorGroups</code> is very important.</p>

<p>Each variant is configured by several Product Flavor objects:
<code>android.defaultConfig</code>
One from the <code>abi</code> group
One from the <code>version</code> group</p>

<p>The order of the group drives which flavor override the other, which is important for resources when a value in a flavor replaces a value defined in a lower priority flavor.</p>

<p>The flavor groups is defined with higher priority first. So in this case:
<code>abi &gt; version &gt; defaultConfig</code></p>

<p>Multi-flavors projects also have additional sourcesets, similar to the variant sourcesets but without the build type:</p>

<p><code>android.sourceSets.x86Freeapp</code>   Location <code>src/x86Freeapp/</code>       <br />
<code>android.sourceSets.armPaidapp</code>   Location <code>src/armPaidapp/</code>      <br />
etc…</p>

<p><strong>These allow customization at the flavor-combination level. They have higher priority than the basic flavor sourcesets, but lower priority than the build type sourcesets.</strong></p>

<h3 id="advanced-build-customization">Advanced Build Customization</h3>

<h4 id="build-options">Build options</h4>

<h5 id="java-compilation-options">Java Compilation options</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">compileOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="n">sourceCompatibility</span> <span class="o">=</span> <span class="s">&quot;1.6&quot;</span>
</span><span class="line">        <span class="n">targetCompatibility</span> <span class="o">=</span> <span class="s">&quot;1.6&quot;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Default value is “1.6”. This affect all tasks compiling Java source code.</p>

<h5 id="aapt-options">aapt options</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">aaptOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="n">noCompress</span> <span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span>
</span><span class="line">        <span class="n">ignoreAssetsPattern</span> <span class="s">&quot;!.svn:!.git:!.ds_store:!*.scc:.*:&lt;dir&gt;_*:!CVS:!thumbs.db:!picasa.ini:!*~&quot;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This affects all tasks using aapt.</p>

<h5 id="dex-options">dex options</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">dexOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="n">incremental</span> <span class="kc">false</span>
</span><span class="line">        <span class="n">preDexLibraries</span> <span class="o">=</span> <span class="kc">false</span>
</span><span class="line">        <span class="n">jumboMode</span> <span class="o">=</span> <span class="kc">false</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This affects all tasks using dex.</p>

<h5 id="manipulating-tasks">Manipulating tasks</h5>

<p>[简单的Java项目一般都是有限的任务一起工作然后得到一个输出，例如<code>classes</code> 任务是用来编译Java源代码的任务，在<code>build.gradle</code> 文件中可以使用<code>classes</code> 来引用]</p>

<p>Basic Java projects have a finite set of tasks that all work together to create an output.</p>

<p>The <code>classes</code> task is the one that compile the Java source code.
It’s easy to access from <code>build.gradle</code> by simply using <code>classes</code> in a script. This is a shortcut for <code>project.tasks.classes</code>.</p>

<p>[但是Android项目优点复杂，因为它可能有很多相同的任务，这些任务的名称是基于build type和product flavor来生成的]</p>

<p>In Android projects, this is a bit more complicated because there could be a large number of the same task and their name is generated based on the Build Types and Product Flavors.</p>

<p>In order to fix this, the android object has two properties:</p>

<p><code>applicationVariants</code> (only for the app plugin)      <br />
<code>libraryVariants</code> (only for the library plugin)     <br />
<code>testVariants</code> (for both plugins)        </p>

<p>All three return a <code>DomainObjectCollection</code> of <code>ApplicationVariant</code>, <code>LibraryVariant</code>, and <code>TestVariant</code> objects respectively.</p>

<p>Note that accessing any of these collections will trigger the creations of all the tasks. This means no (re)configuration should take place after accessing the collections.</p>

<p>The <code>DomainObjectCollection</code> gives access to all the objects directly, or through filters which can be convenient.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span><span class="o">.</span><span class="na">applicationVariants</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> <span class="n">variant</span> <span class="o">-&gt;</span>
</span><span class="line">    <span class="o">....</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>All three variant classes share the following properties:</p>

<p><img src="http://hujiaweibujidao.github.io/images/gradle4.png" alt="image" /></p>

<p>The ApplicationVariant class adds the following:</p>

<p><img src="http://hujiaweibujidao.github.io/images/gradle5.png" alt="image" /></p>

<p>The LibraryVariant class adds the following:</p>

<p><img src="http://hujiaweibujidao.github.io/images/gradle6.png" alt="image" /></p>

<p>The TestVariant class adds the following:</p>

<p><img src="http://hujiaweibujidao.github.io/images/gradle7.png" alt="image" /></p>

<p>API for Android specific task types.</p>

<p><img src="http://hujiaweibujidao.github.io/images/gradle8.png" alt="image" /></p>

<p><strong>The API for each task type is limited due to both <code>how Gradle works</code> and <code>how the Android plugin sets them up</code>.</strong></p>

<p>1 First, Gradle is meant to have the tasks be only configured for <code>input/output</code> location and possible optional flags. So here, the tasks only define (some of) the inputs/outputs.</p>

<p>2 Second, the input for most of those tasks is non-trivial, often coming from mixing values from the sourceSets, the Build Types, and the Product Flavors. To keep build files simple to read and understand, the goal is to let developers modify the build by tweak these objects through the DSL, rather than diving deep in the inputs and options of the tasks and changing them.</p>

<p><strong>Also note, that except for the <code>ZipAlign</code> task type, all other types require setting up <code>private data</code> to make them work. This means it’s not possible to manually create new tasks of these types.</strong></p>

<p>[除了ZipAlign任务之外，其他类型的任务都需要private data才能工作，所以没有办法manual创建这些类型的新任务]</p>

<p><strong>This API is subject to change.</strong> In general the current API is around giving access to the outputs and inputs (when possible) of the tasks to add extra processing when required). Feedback is appreciated, especially around needs that may not have been foreseen.</p>

<p>For Gradle tasks (<code>DefaultTask</code>, <code>JavaCompile</code>, <code>Copy</code>, <code>Zip</code>), refer to the Gradle documentation.</p>

<h4 id="buildtype-and-product-flavor-property-reference">BuildType and Product Flavor property reference</h4>

<p>coming soon.</p>

<p>For Gradle tasks (<code>DefaultTask</code>, <code>JavaCompile</code>, <code>Copy</code>, <code>Zip</code>), refer to the Gradle documentation.</p>

<h4 id="using-sourcecompatibility-17">Using sourceCompatibility 1.7</h4>

<p>[兼容JDK 1.7的方式，使用某些特性时还需要注意项目<code>minSdkVersion</code> 的配置]</p>

<p>With <code>Android KitKat (buildToolsVersion 19)</code> you can use the <code>diamond operator</code>, <code>multi-catch</code>, <code>strings in switches</code>, <code>try with resources</code>, etc. To do this, add the following to your build file:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">compileSdkVersion</span> <span class="mi">19</span>
</span><span class="line">    <span class="n">buildToolsVersion</span> <span class="s">&quot;19.0.0&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">defaultConfig</span> <span class="o">{</span>
</span><span class="line">        <span class="n">minSdkVersion</span> <span class="mi">7</span>
</span><span class="line">        <span class="n">targetSdkVersion</span> <span class="mi">19</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">compileOptions</span> <span class="o">{</span>
</span><span class="line">        <span class="n">sourceCompatibility</span> <span class="n">JavaVersion</span><span class="o">.</span><span class="na">VERSION_1_7</span>
</span><span class="line">        <span class="n">targetCompatibility</span> <span class="n">JavaVersion</span><span class="o">.</span><span class="na">VERSION_1_7</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that you can use <code>minSdkVersion</code> with a value earlier than 19, for all language features except <code>try with resources</code>. If you want to use <code>try with resources</code>, you will need to also use a <code>minSdkVersion</code> of 19.</p>

<p>You also need to make sure that Gradle is using version 1.7 or later of the JDK. (And version 0.6.1 or later of the Android Gradle plugin.)</p>

<p class="post-footer">
                        Original link:<a href="http://hujiaweibujidao.github.io/blog/2014/10/15/gradle-plugin-user-guide-2/">http://hujiaweibujidao.github.io/blog/2014/10/15/gradle-plugin-user-guide-2/</a><br />Written by <a href="http://hujiaweibujidao.github.io">hujiawei</a>&nbsp;Posted at <a href="http://hujiaweibujidao.github.io">http://hujiaweibujidao.github.io</a><br />Feel free to read or comment it, and if you want to copy it into your own site, please copy it with its Original Link showed above or you can see the license below for more details.If you have any problem or suggestion, please comment below. :-)<br />Thanks a lot. Hope you enjoy here! :-)</p>
</div>


		<footer>
			<p class="meta">
				
  

<span class="byline author vcard">Posted by <span class="fn">hujiawei</span></span>

				








  


<time datetime="2014-10-15T12:00:00+08:00" pubdate data-updated="true">Oct 15<span>th</span>, 2014</time>
				

<span class="categories">
  
    <a class='category' href='/blog/categories/mobile/'>mobile</a>
  
</span>


			</p>
			
			<div class="sharing">
  
  
  
</div>

			
			<p class="meta">
				
				<a class="basic-alignment left" href="/blog/2014/10/13/gradle-plugin-user-guide-1/" title="Previous Post: Gradle Plugin for Android Development User Guide (1)">&laquo; Gradle Plugin for Android Development User Guide (1)</a>
				
				
			</p>
		</footer>
	</article>
	

	
	<section>
		<h1>Comments</h1>
		<div id="comments" aria-live="polite">
			<!-- Duoshuo Comment BEGIN   data-title=""-->
<div class="ds-thread"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"hujiaweibujidao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END -->

		</div>
	</section>
	
</div>

<aside class="sidebar">
  
	<section>
	<h1>关于博主</h1><br/>
  <a href="/aboutme/"><img src="/images/me-small.png" width="250px" height="210px" alt="protrait"/></a><br/>
  <p>Hi, I'm Hujiawei, from P.R.China. Now I'm a postgraduate student studying in <a href="http://www.tsinghua.edu.cn/publish/th/index.html">Tsinghua University</a>.
  Wanna know me? <a href="/aboutme/">See here.</a> 
  </p>
  
  <img src="/images/conan-mainperson.png" width="250px" height="210px" alt="conan"/>
  
  <br/>
  
  <a href="http://weibo.com/hujiaweiyinger"><img src="/images/sinaweibo.png" width="40px" height="40px"/></a> &nbsp;
  <a href="https://github.com/hujiaweibujidao"><img src="/images/github.png" width="40px" height="40px"/></a>&nbsp;
  <a href="http://hujiawei.tumblr.com"><img src="/images/tumblr.png" width="40px" height="40px"/></a> &nbsp;
  <a href="https://twitter.com/hujiaweiyinger"><img src="/images/twitter.png" width="40px" height="40px"/></a>&nbsp;
  <a href="http://www.douban.com/people/60272837/"><img src="/images/douban.png" width="40px" height="40px"/></a>
 
 <br/>
 <br/>
 <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=50&skin=1&isTitle=0&noborder=1&isWeibo=1&isFans=0&uid=1740244950&verifier=68702156&dpc=1"></iframe>
    <br/>
    <!--autoplay="autoplay" -->
    <!--
<audio width="200" height="32" 
style="margin: auto; top: 0; right: 0; bottom: 0; left: 0;" 
controls="controls" 
name="media" 
src="http://hujiaweibujidao.github.io/music/Wouldnt-It-Be-Nice.mp3">
</audio>
-->
  
  
  <!--baidu-->
  <!--
  <div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>  
-->

</section>
<section>
 <h1>分类目录</h1>
 <ul id="categories">
	 <li class='category'><a href='/blog/categories/algorithm/'>algorithm (18)</a></li>
<li class='category'><a href='/blog/categories/android/'>android (5)</a></li>
<li class='category'><a href='/blog/categories/hadoop/'>hadoop (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (1)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/machinelearning/'>machinelearning (2)</a></li>
<li class='category'><a href='/blog/categories/math/'>math (26)</a></li>
<li class='category'><a href='/blog/categories/matlab/'>matlab (1)</a></li>
<li class='category'><a href='/blog/categories/mobile/'>mobile (2)</a></li>
<li class='category'><a href='/blog/categories/mobiledev/'>mobiledev (5)</a></li>
<li class='category'><a href='/blog/categories/music/'>music (2)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (6)</a></li>
<li class='category'><a href='/blog/categories/opencv/'>opencv (5)</a></li>
<li class='category'><a href='/blog/categories/picture/'>picture (3)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (4)</a></li>

 </ul>
</section>
<section>
  <h1>近期文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/15/gradle-plugin-user-guide-2/">Gradle Plugin for Android Development User Guide (2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/13/gradle-plugin-user-guide-1/">Gradle Plugin for Android Development User Guide (1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/16/bootcamp-an-open-source-django-site/">Bootcamp an Open Source Django Site</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/12/download-coursera-courses-in-the-fastest-way/">Download Coursera Courses in the Fastest Way</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/01/python-algorithms-graphs/">Python Algorithms - C9 Graphs</a>
      </li>
    
  </ul>
  
  <h1>热评文章</h1>
<!-- 多说热评文章 start -->
	<div class="ds-top-threads" data-range="daily" data-num-items="5"></div>
<!-- 多说热评文章 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"hujiaweibujidao"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

</section>
<section>
	<h1>好友博客</h1>
	<ul>
		<li>
			<a href="http://doufunao.github.io/">豆腐脑的幻想乡</a>
		</li>
		<li>
			<a href="http://c4fun.cn/">Code 4 Fun</a>
		</li>
		<li>
			<a href="http://www.tanglei.name/">TangLei blog</a>
		</li>
		<li>
			<a href="http://ontheroad.sinaapp.com/">Tian Jun-Find My Way</a>
		</li>
		
		<li>
			<a href="http://www.liaoxuefeng.com/">廖雪峰的官方网站</a>
		</li>
		<li>
			<a href="http://beader.me/">Beader</a>
		</li>
		<li>
			<a href="http://blog.csdn.net/v_JULY_v">结构之法，算法之道</a>
		</li>
				<li>
			<a href="http://www.renfei.org/blog/">Renfei Song</a>
		</li>
		<li>
			<a href="http://bluedavy.me">BlueDavy之技术blog</a>
		</li>
		<li>
			<a href="http://blog.jobbole.com/category/python/">伯乐在线-Python</a>
		</li>
		<li>
			<a href="http://www.douban.com/group/python/">豆瓣小组-Python</a>
		</li>
		<li>
			<a href="#">这里会是你吗?</a>
		</li>
	</ul>
</section>
	
</aside>


		</div>
	</div>
	
	<footer role="contentinfo">
		<p>
  	Copyright &copy; 2014 - hujiawei - <a href="http://hujiaweibujidao.github.io/happybirthday/">Happy birthday to MY QUEEN</a> - <span class="credit">Proudly Powered by <a href="http://octopress.org">Octopress</a></span>
  	

<!--baidu-->
<!--
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"1","bdPos":"left","bdTop":"250"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
-->

	<!-- CNZZ -->
	&nbsp;&nbsp;
	<script type="text/javascript">
		var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cspan id='cnzz_stat_icon_1000165127'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000165127%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
	</script>
	
	<!--baidu share-->
	<!--
	<div class="bdsharebuttonbox" style="display: inline;"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
	-->
	<!-- license -->
	<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/deed.zh"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nd/3.0/88x31.png" /></a>
	本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/deed.zh">知识共享署名-禁止演绎 3.0 未本地化版本许可协议</a>进行许可。

</p>

<!--hujiawei custom blockquote-->
<!--for block quote
<style>
blockquote{
	font:inherit;
	font-size:60%;
	font-style:normal;
	line-height:1.0em;
	color:rgba(0,0,0,0.5);
}
</style>-->

<!-- gutter for code line-numbers!! -->
<!--for block quote-->
<!--
<style>
blockquote{
	font:inherit;
	font-size:60%;
	font-style:normal;
	line-height:1.0em;
	color:rgba(0,0,0,0.5);
}

.gutter{
	display: none;
}

.highlight, .gist-highlight {
margin-bottom: 1.8em;
background: #002b36;
overflow-y: hidden;
overflow-x: auto;
}
</style>
-->

<!-- mathjax config similar to math.stackexchange  -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

<!-- the following line is incorrect! -->
<!--
<script type="text/javascript" src="https://stackedit.io/libs/MathJax/MathJax.js?config=TeX-AMS_HTML"></script>
-->



<!--return to top-->
<style>
	.returnTop {
		position: fixed;
		_position: absolute;
		right: 10px;
		bottom: 200px;
		_bottom: auto;
		display: none;
		width: 40px;
		height: 40px;
		border: 1px solid #61b72e;
		border-radius: 4px;
		background: #fff;
		box-shadow: 0 0 5px #F5F5F5;
		text-indent: -9999px;
		cursor: pointer;
	}
	.returnTop .s {
		position: absolute;
		top: -2px;
		_top: -20px;
		left: 10px;
		width: 0;
		height: 0;
		border-width: 10px;
		border-color: transparent transparent #61b72e;
		border-style: dashed dashed solid;
	}
	.returnTop .b {
		position: absolute;
		top: 18px;
		left: 16px;
		height: 12px;
		width: 8px;
		background: #61b72e;
	}
</style>
<div class="returnTop" title="嗖的就上去了！">
	<span class="s"></span>
	<span class="b"></span>
	返回顶部
</div>
<script type="text/javascript">
$(function(){
$(window).bind("scroll", function(){

var scrollTopNum = $(document).scrollTop(),
winHeight = $(window).height(),
returnTop = $("div.returnTop");

(scrollTopNum > 0) ? returnTop.fadeIn("fast") : returnTop.fadeOut("fast");

if (!-[1,]&&!window.XMLHttpRequest) {
returnTop.css("top", scrollTopNum + winHeight - 200);
}

});

$("div.returnTop").click(function() {
$("html, body").animate({ scrollTop: 0 }, 100);
});

});
</script>

	</footer>
	
	













</body>
</html>
