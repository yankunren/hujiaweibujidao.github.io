
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Android NDK and OpenCV development with Android Studio - Hujiawei Bujidao</title>
  <meta name="author" content="hujiawei">

  
  <meta name="description" content="———— If you do NOT know Chinese, you can just skip this part ————- 一直打算将原来的XFace进行改进，最近终于有了些时间可以动手了，改进计划如下：开发上使用Android Studio作为新的开发环境，配上新的构建系统Gradle &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hujiaweibujidao.github.io/blog/2014/10/22/android-ndk-and-opencv-development-with-android-studio">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hujiawei Bujidao" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <!--
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  -->
  <script type='text/javascript' src='http://ajax.useso.com/ajax/libs/jquery/1.7.2/jquery.min.js?ver=3.4.2'></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
<link href="http://fonts.useso.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.useso.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
  <!--
  

  -->
</head>

<body   >

	<header role="banner">
		
<hgroup style="text-align: center">
	<h1><a href="/"><img src="/images/conan-paper-small.png"  />Hujiawei Bujidao<img src="/images/conan-hat-small.png"  /></a></h1>
	
	<h2>I will always be your savior! A secret makes a man man!</h2>
	
</hgroup>


	</header>
	<nav role="navigation">
		<ul class="subscription" data-subscription="rss">
  <!--<li><a href="https://github.com/hujiaweibujidao" rel="subscribe-rss" title="subscribe via RSS">View me on GitHub</a></li>-->
  
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
  <!--
  
  --> 
</ul>
<!--
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hujiaweibujidao.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form> 
  
-->
<ul class="main-navigation">
  <li><a href="/blog/archives/">Blog</a></li>
  <li><a href="/aboutme/">AboutMe</a></li>
  <li><a href="/math/">Math</a></li>
  <li><a href="/python/">Python</a></li>
  <li><a href="/mobile/">Mobile</a></li>
  
  <li><a href="/blog/categories/algorithm/">Algorithms</a></li>
  <!--
  <li><a href="/blog/categories/mobiledev/">MobileDev</a></li>
  <li><a href="/datamining/">ML-DM-PR</a></li>
  -->
  <li><a href="/blog/categories/music/">Music</a></li>
  <li><a href="/blog/categories/picture/">Picture</a></li>
  <!--
  <li><a href="/xjava/">XJava</a></li>
  -->
  <!-- <li><a href="/datamining/">Projects</a></li> -->
</ul>


	</nav>
	<div id="main">
		<div id="content">
			<div>

<article class="hentry" role="article">
		
  <header>
    
      <h1 class="entry-title">Android NDK and OpenCV Development With Android Studio</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-22T09:51:00+08:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>———— If you do <strong>NOT</strong> know Chinese, you can just skip this part ————-</p>

<p>一直打算将原来的XFace进行改进，最近终于有了些时间可以动手了，改进计划如下：开发上使用Android Studio作为新的开发环境，配上新的构建系统Gradle；应用上将修改原来的UI设计，内部代码也将有很大的变化，可能会用上ContentProvider和Service等略高级内容；算法上打算让应用扩展性增强以适应不同的算法，并结合强大的Android Studio和Gradle让这个项目变得更加丰富。说了一堆废话，言归正传，本文的重点是介绍如何在Android Studio中进行NDK开发(目前它还不完全支持NDK开发)，难点是NDK中还包含OpenCV的动态库。最后的最后，本文剩下部分将使用英文，因为它要成为我在StackOverflow上的处女答，么么哒 ~O(∩_∩)O~</p>

<p>—————————- Here is the right stuff you may need ——————————-</p>

<h4 id="this-post-shows-how-to-develop-an-android-ndk-application-with-opencv-included-using-android-studio-and-gradle-if-youre-working-on-migrating-your-original-eclipse-project-to-android-studio-you-may-find-this-post-is-what-exactly-you-want">This post shows how to develop an Android NDK application with OpenCV included using Android Studio and Gradle. If you’re working on migrating your original Eclipse Project to Android Studio, you may find this post is what exactly you want!</h4>

<p>OK，Let’s start! </p>

<h3 id="section-1--three-things-you-must-know">Section 1:  Three things you must know</h3>

<h4 id="firstly-if-you-are-not-familiar-with-android-studio-and-gradle-you-may-find-these-links-useful-if-you-already-know-these-well-skip-this-part">1.Firstly, if you are not familiar with Android Studio and Gradle, you may find these links useful. (if you already know these well, skip this part)</h4>

<p>①<a href="http://developer.android.com/sdk/installing/create-project.html">Creating a new Project with Android Studio</a></p>

<p>②<a href="http://developer.android.com/sdk/installing/studio-build.html">Building Your Project with Gradle</a></p>

<p>③<a href="http://tools.android.com/tech-docs/new-build-system/user-guide">Gradle Plugin User Guide</a>  or you may want to read a Chinese commented version in my blog <a href="http://hujiaweibujidao.github.io/blog/2014/10/13/gradle-plugin-user-guide-1/">here</a>.</p>

<h4 id="secondly-if-your-android-ndk-project-is-not-that-complicatedfor-example-having-no-opencv-included-you-may-wanna-see-ph0bs-introduction-here-its-quite-a-nice-job-with-a-video-recorded-you-can-also-follow-section-2-in-this-post-to-get-a-simple-android-ndk-demo-application">2.Secondly, if your android ndk project is not that complicated(for example, having no opencv included), you may wanna see <code>ph0b</code>’s introduction here, it’s quite a nice job with a video recorded! (you can also follow Section 2 in this post to get a simple Android NDK demo application)</h4>

<p><a href="http://ph0b.com/android-studio-gradle-and-ndk-integration/"><code>ph0b</code>’s post: ANDROID STUDIO, GRADLE AND NDK INTEGRATION</a></p>

<h4 id="thirdly-if-those-above-two-do-not-meet-your-needs-then-i-think-you-may-want-to-customize-the-androidmk-with-gradle-in-android-studio-thanks-to-gaku-ueda-he-had-made-a-great-job-explaining-how-to-achieve-that-goal-actually-i-have-found-another-nicer-solution-without-adding-that-many-codes-and-also-achieve-that-goal---find-it-out-in-the-next-sections">3.Thirdly, if those above two do not meet your needs, then I think you may want to customize the Android.mk with Gradle in Android Studio. Thanks to <code>Gaku Ueda</code>, he had made a great job explaining how to achieve that goal. Actually I have found another nicer solution without adding that many codes and also achieve that goal. :-) Find it out in the next sections.</h4>

<p><a href="http://blog.gaku.net/ndk/"><code>Gaku Ueda</code>’s post: Using custom Android.mk with Gradle/Android Studio</a></p>

<p>OK, I will cover all above and give another nice solution in the end, have fun!</p>

<h3 id="section-2-a-simple-android-ndk-demo-application">Section 2: A simple Android NDK demo application</h3>

<p>This section shows creating a simple Android NDK demo application, if you already know, you can directly go the section 3.</p>

<p>1.Create a new Android project named <code>NDKDemo</code> with a blank Activity in AS(=Android Studio).</p>

<p>2.Give an <code>id</code> to the <code>TextView</code> in <code>activity_my.xml</code> such as <code>android:id="@+id/textview"</code>, then add these codes in <code>MyActivity.java</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="nd">@Override</span>
</span><span class="line"><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class="line">    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_my</span><span class="o">);</span>
</span><span class="line">
</span><span class="line">    <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">textview</span><span class="o">);</span>
</span><span class="line">    <span class="n">textView</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">hello</span><span class="o">());</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">static</span> <span class="o">{</span>
</span><span class="line">    <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">);</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="kd">public</span> <span class="kd">native</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>3.Create a new directory <code>jni</code> in folder <code>app/src/main</code>, then you have <code>java</code>, <code>jni</code> and <code>res</code> in this folder.</p>

<ol>
  <li>**This step is very important! You can add a external tool to run the <code>javah</code> command without typing that much code! **</li>
</ol>

<p>Open AS’s <code>Preferences</code>, then find <code>External Tools</code> in <code>IDE Settings</code>, click <code>+</code> to add one tool with the following configurations. (Make sure you have add <code>JDK tools</code>  in your <code>system path</code>, if you don’t know how, click <a href="http://hujiaweibujidao.github.io/blog/2014/02/21/android-ndk-and-opencv-development-4/">here</a>)</p>

<p><img src="http://hujiaweibujidao.github.io/images/javah_as.png" alt="image" /></p>

<p>With the help of this tool, each time we right click on a <code>class file</code>, then choose <code>Android Tools -&gt; javah</code> to run this tool, it will automatically generate a <code>C head file</code> for us in the target folder <code>$ModuleFileDir$/src/main/jni</code> , in this case, it is <code>app/src/main/jni</code>. Try this on <code>MyActivity.java</code> file now! The console will print out a log like:</p>

<p><code>/usr/bin/javah -v -jni -d /Users/hujiawei/AndroidStudioProjects/NDKDemo/app/src/main/jni com.android.hacks.ndkdemo.MyActivity
[Creating file RegularFileObject[/Users/hujiawei/AndroidStudioProjects/NDKDemo/app/src/main/jni/com_android_hacks_ndkdemo_MyActivity.h]]</code></p>

<p>Then you get a <code>com_android_hacks_ndkdemo_MyActivity.h</code> file in <code>jni</code>  folder with the following content.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="cm">/* DO NOT EDIT THIS FILE - it is machine generated */</span>
</span><span class="line"><span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">jni</span><span class="o">.</span><span class="na">h</span><span class="o">&gt;</span>
</span><span class="line"><span class="cm">/* Header for class com_android_hacks_ndkdemo_MyActivity */</span>
</span><span class="line">
</span><span class="line"><span class="err">#</span><span class="n">ifndef</span> <span class="n">_Included_com_android_hacks_ndkdemo_MyActivity</span>
</span><span class="line"><span class="err">#</span><span class="n">define</span> <span class="n">_Included_com_android_hacks_ndkdemo_MyActivity</span>
</span><span class="line"><span class="err">#</span><span class="n">ifdef</span> <span class="n">__cplusplus</span>
</span><span class="line"><span class="n">extern</span> <span class="s">&quot;C&quot;</span> <span class="o">{</span>
</span><span class="line"><span class="err">#</span><span class="n">endif</span>
</span><span class="line"><span class="cm">/*</span>
</span><span class="line"><span class="cm"> * Class:     com_android_hacks_ndkdemo_MyActivity</span>
</span><span class="line"><span class="cm"> * Method:    hello</span>
</span><span class="line"><span class="cm"> * Signature: ()Ljava/lang/String;</span>
</span><span class="line"><span class="cm"> */</span>
</span><span class="line"><span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span> <span class="nf">Java_com_android_hacks_ndkdemo_MyActivity_hello</span>
</span><span class="line">  <span class="o">(</span><span class="n">JNIEnv</span> <span class="o">*,</span> <span class="n">jobject</span><span class="o">);</span>
</span><span class="line">
</span><span class="line"><span class="err">#</span><span class="n">ifdef</span> <span class="n">__cplusplus</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line"><span class="err">#</span><span class="n">endif</span>
</span><span class="line"><span class="err">#</span><span class="n">endif</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>5.Write a simple <code>C</code> implementation file named <code>main.c</code> in <code>jni</code> folder</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="err">#</span><span class="n">include</span> <span class="o">&lt;</span><span class="n">jni</span><span class="o">.</span><span class="na">h</span><span class="o">&gt;</span>
</span><span class="line"><span class="err">#</span><span class="n">include</span> <span class="s">&quot;com_android_hacks_ndkdemo_MyActivity.h&quot;</span>
</span><span class="line">
</span><span class="line"><span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span> <span class="nf">Java_com_android_hacks_ndkdemo_MyActivity_hello</span>
</span><span class="line">  <span class="o">(</span><span class="n">JNIEnv</span> <span class="o">*</span> <span class="n">env</span><span class="o">,</span> <span class="n">jobject</span> <span class="n">obj</span><span class="o">){</span>
</span><span class="line">    <span class="k">return</span> <span class="o">(*</span><span class="n">env</span><span class="o">)-&gt;</span><span class="n">NewStringUTF</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="s">&quot;Hello from JNI&quot;</span><span class="o">);</span>
</span><span class="line">  <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>6.In the <code>build.gradle</code> file under <code>app</code> module, add the following codes to configure <code>ndk</code> in <code>defaultConfig</code> element, here we just give the uni module a name <code>hello</code>, you can find other configurations in <a href="http://tools.android.com/tech-docs/new-build-system/user-guide">Gradle Plugin User Guide</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">defaultConfig</span> <span class="o">{</span>
</span><span class="line">    <span class="n">applicationId</span> <span class="s">&quot;com.android.hacks.ndkdemo&quot;</span>
</span><span class="line">    <span class="n">minSdkVersion</span> <span class="mi">16</span>
</span><span class="line">    <span class="n">targetSdkVersion</span> <span class="mi">20</span>
</span><span class="line">    <span class="n">versionCode</span> <span class="mi">1</span>
</span><span class="line">    <span class="n">versionName</span> <span class="s">&quot;1.0&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">ndk</span><span class="o">{</span>
</span><span class="line">        <span class="n">moduleName</span> <span class="s">&quot;hello&quot;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>7.In order to let Gradle run <code>ndk-build</code> command (in some task, maybe <code>NdkCompile</code> task), we should configure the <code>ndk.dir</code> in <code>local.properties</code> file in Project root.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">sdk</span><span class="o">.</span><span class="na">dir</span><span class="o">=/</span><span class="n">Volumes</span><span class="o">/</span><span class="n">hujiawei</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">hujiawei</span><span class="o">/</span><span class="n">Android</span><span class="o">/</span><span class="n">android_sdk</span>
</span><span class="line"><span class="n">ndk</span><span class="o">.</span><span class="na">dir</span><span class="o">=/</span><span class="n">Volumes</span><span class="o">/</span><span class="n">hujiawei</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">hujiawei</span><span class="o">/</span><span class="n">Android</span><span class="o">/</span><span class="n">android_ndk</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>8.OK, everything is ready, click <code>Run</code> to give it a try, you will see the result like</p>

<p><img src="http://hujiaweibujidao.github.io/images/ndkdemo_s s.png" alt="image" /></p>

<p>All right, so what’s happening inside?</p>

<p><strong>Since you have a <code>jni</code> folder, Gradle will consider it as a default native code folder. When Gradle builds the <code>app</code>, it will run <code>ndk-build</code> command(since you have configured <code>ndk.dir</code>,  Gradle knows where to find it) with a generated <code>Android.mk</code> file(locates in <code>app/build/intermediates/ndk/debug/Android.mk</code>), after compiling the native codes, it will generate the <code>libs</code> and <code>obj</code> folder into folder  <code>app/build/intermediates/ndk/debug/</code>(see the figure below). Gradle will then package the <code>libs</code> into final <code>apk</code> file in folder <code>app/build/outputs/apk/app-debug.apk</code>(you can unarchive this file to check whether <code>libs</code> is contained)</strong></p>

<p><code>app/build/intermediates/ndk/debug</code> (<code>lib</code> and <code>obj</code> folders)</p>

<p><img src="http://hujiaweibujidao.github.io/images/ndkdemo_ndk.png" alt="image" /></p>

<p><code>app/build/outputs/apk/app-debug.apk</code> (and files within it)</p>

<p><img src="http://hujiaweibujidao.github.io/images/ndkdemo_apk.png" alt="image" /></p>

<h3 id="secontion-3-using-opencv">Secontion 3: Using OpenCV</h3>

<p>If your project do not use OpenCV, then the section 2 is just enough. But what if you wanna use OpenCV to do other stuff? Of course, we want to use <code>OpenCV for Android</code> instead of  <code>JavaCV</code> here, and Of course, we need to package OpenCV library for Android into our application’s APK file (then users who use this app does not have to install <code>OpenCV Manager</code>). So, how can we achieve these goals?</p>

<p>The simplest way has been posted by <code>TGMCians</code> on Stack Overflow <a href="http://stackoverflow.com/questions/17767557/how-to-use-opencv-in-android-studio-using-gradle-build-tool?answertab=active#tab-top">here</a>, that is, let the main app include the OpenCV library as a dependency, and copy all <code>&lt;abi&gt;/*.so</code> files in OpenCV for Android SDK to <code>jniLibs</code> folder under <code>app/src/main/</code>, Gradle will automatically package these <code>&lt;abi&gt;/*.so</code> files into <code>libs</code> folder within the final APK file. Of course, this method will work, but it has a few backwards: (1) Unless you only copy the needed <code>*.so</code> files, you will always have a large APK due to this reason; (2) How about the building of the <code>jni</code> files? How to run <code>ndk-build</code> if these files contain <code>opencv</code> related codes? </p>

<p>So, here comes to our <code>Using custom Android.mk with Gradle and Android Studio</code> part. For testing, we first creat an <code>Android.mk</code> and an <code>Application.mk</code> file under <code>jni</code> folder. </p>

<p><code>Android.mk</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">LOCAL_PATH</span> <span class="o">:=</span> <span class="n">$</span><span class="o">(</span><span class="n">call</span> <span class="n">my</span><span class="o">-</span><span class="n">dir</span><span class="o">)</span>
</span><span class="line">
</span><span class="line"><span class="n">include</span> <span class="n">$</span><span class="o">(</span><span class="n">CLEAR_VARS</span><span class="o">)</span>
</span><span class="line">
</span><span class="line"><span class="n">LOCAL_SRC_FILES</span> <span class="o">:=</span> <span class="n">main</span><span class="o">.</span><span class="na">c</span>
</span><span class="line"><span class="n">LOCAL_LDLIBS</span> <span class="o">+=</span> <span class="o">-</span><span class="n">llog</span>
</span><span class="line"><span class="n">LOCAL_MODULE</span> <span class="o">:=</span> <span class="n">hello</span>
</span><span class="line">
</span><span class="line"><span class="n">include</span> <span class="n">$</span><span class="o">(</span><span class="n">BUILD_SHARED_LIBRARY</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>Application.mk</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">APP_ABI</span> <span class="o">:=</span> <span class="n">armeabi</span>
</span><span class="line"><span class="n">APP_PLATFORM</span> <span class="o">:=</span> <span class="n">android</span><span class="o">-</span><span class="mi">16</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Thanks to <code>Gaku Ueda</code>, he had made a great job explaining how to achieve that goal with <a href="http://blog.gaku.net/ndk/">this post</a>. The core idea of his method is to run <code>ndk-build</code> command in some task, then zip the <code>&lt;abi&gt;/*.so</code> files under the output <code>app/build/libs/</code> folder into a <code>jar</code> file which is finally put in <code>app/build/libs/</code> folder, then add a compile dependency to this jar file. The key code for his method listed below</p>

<p><strong>Notice 1: When using custom Android.mk, we should first disable Gradle to build the <code>jni</code> folder as before, and <code>sourceSets.main.jni.srcDirs = []</code> just does this job!</strong></p>

<p><strong>Notice 2: The code is not exactly the same with Gaku Ueda’s code: <code>tasks.withType(Compile)</code> to <code>tasks.withType(JavaCompile)</code>, because <code>Compile</code> is deprecated.</strong></p>

<p><strong>Notice 3: You can get  <code>$ndkDir</code> variable with <code>project.plugins.findPlugin('com.android.application').getNdkFolder()</code> or you can define it in <code>grade.properties</code> file under Project root, so you need to add <code>ndkDir=path/to/your/ndk</code> in that file, if the file is not created, simply create a new one.</strong></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">android</span><span class="o">{</span>
</span><span class="line">	<span class="o">...</span>
</span><span class="line">    <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">jni</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class="line">
</span><span class="line">    <span class="n">task</span> <span class="nf">ndkBuild</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Exec</span><span class="o">,</span> <span class="nl">description:</span> <span class="err">&#39;</span><span class="n">Compile</span> <span class="n">JNI</span> <span class="n">source</span> <span class="n">via</span> <span class="n">NDK</span><span class="err">&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">	    <span class="n">ndkDir</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">findPlugin</span><span class="o">(</span><span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">application</span><span class="err">&#39;</span><span class="o">).</span><span class="na">getNdkFolder</span><span class="o">()</span>
</span><span class="line">        <span class="n">commandLine</span> <span class="s">&quot;$ndkDir/ndk-build&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">NDK_PROJECT_PATH</span><span class="o">=</span><span class="n">build</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">APP_BUILD_SCRIPT</span><span class="o">=</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">jni</span><span class="o">/</span><span class="n">Android</span><span class="o">.</span><span class="na">mk</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">NDK_APPLICATION_MK</span><span class="o">=</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">jni</span><span class="o">/</span><span class="n">Application</span><span class="o">.</span><span class="na">mk</span><span class="err">&#39;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">task</span> <span class="nf">ndkLibsToJar</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Zip</span><span class="o">,</span> <span class="nl">dependsOn:</span> <span class="err">&#39;</span><span class="n">ndkBuild</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">description:</span> <span class="err">&#39;</span><span class="n">Create</span> <span class="n">a</span> <span class="n">JAR</span> <span class="n">of</span> <span class="n">the</span> <span class="kd">native</span> <span class="n">libs</span><span class="err">&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="n">destinationDir</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">buildDir</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class="line">        <span class="n">baseName</span> <span class="err">&#39;</span><span class="n">ndk</span><span class="o">-</span><span class="n">libs</span><span class="err">&#39;</span>
</span><span class="line">        <span class="n">extension</span> <span class="err">&#39;</span><span class="n">jar</span><span class="err">&#39;</span>
</span><span class="line">        <span class="n">from</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">buildDir</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">))</span> <span class="o">{</span> <span class="n">include</span> <span class="err">&#39;</span><span class="o">**/*.</span><span class="na">so</span><span class="err">&#39;</span> <span class="o">}</span>
</span><span class="line">        <span class="n">into</span> <span class="err">&#39;</span><span class="n">lib</span><span class="o">/</span><span class="err">&#39;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">JavaCompile</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="n">compileTask</span> <span class="o">-&gt;</span> <span class="n">compileTask</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">ndkLibsToJar</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">    <span class="o">...</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="n">dependencies</span> <span class="o">{</span>
</span><span class="line">    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">include:</span> <span class="o">[</span><span class="err">&#39;</span><span class="o">*.</span><span class="na">jar</span><span class="err">&#39;</span><span class="o">])</span>
</span><span class="line">    <span class="c1">// add begin</span>
</span><span class="line">    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">buildDir</span><span class="o">,</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">),</span> <span class="nl">include:</span> <span class="err">&#39;</span><span class="o">*.</span><span class="na">jar</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class="line">    <span class="c1">// add end</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>But we can still do a little improvements here. We have already know that Gradle will take <code>jniLibs</code> folder as its default native libraries folder, so we can simply output the <code>libs/&lt;abi&gt;/*.so</code> files generated by <code>ndk-build</code> command into <code>jniLibs</code> folder, so there’s no need to zip these <code>*.so</code> files into a <code>jar</code> file. </p>

<p>The final <code>build.gradle</code> file under <code>app</code> module</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">apply</span> <span class="nl">plugin:</span> <span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">application</span><span class="err">&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">android</span> <span class="o">{</span>
</span><span class="line">    <span class="n">compileSdkVersion</span> <span class="mi">20</span>
</span><span class="line">    <span class="n">buildToolsVersion</span> <span class="s">&quot;20.0.0&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">defaultConfig</span> <span class="o">{</span>
</span><span class="line">        <span class="n">applicationId</span> <span class="s">&quot;com.android.hacks.ndkdemo&quot;</span>
</span><span class="line">        <span class="n">minSdkVersion</span> <span class="mi">16</span>
</span><span class="line">        <span class="n">targetSdkVersion</span> <span class="mi">20</span>
</span><span class="line">        <span class="n">versionCode</span> <span class="mi">1</span>
</span><span class="line">        <span class="n">versionName</span> <span class="s">&quot;1.0&quot;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="c1">// add begin</span>
</span><span class="line">    <span class="n">sourceSets</span><span class="o">.</span><span class="na">main</span><span class="o">.</span><span class="na">jni</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class="line">
</span><span class="line">    <span class="n">task</span> <span class="nf">ndkBuild</span><span class="o">(</span><span class="nl">type:</span> <span class="n">Exec</span><span class="o">,</span> <span class="nl">description:</span> <span class="err">&#39;</span><span class="n">Compile</span> <span class="n">JNI</span> <span class="n">source</span> <span class="n">via</span> <span class="n">NDK</span><span class="err">&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="n">ndkDir</span> <span class="o">=</span> <span class="n">project</span><span class="o">.</span><span class="na">plugins</span><span class="o">.</span><span class="na">findPlugin</span><span class="o">(</span><span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">android</span><span class="o">.</span><span class="na">application</span><span class="err">&#39;</span><span class="o">).</span><span class="na">getNdkFolder</span><span class="o">()</span>
</span><span class="line">        <span class="n">commandLine</span> <span class="s">&quot;$ndkDir/ndk-build&quot;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">NDK_PROJECT_PATH</span><span class="o">=</span><span class="n">build</span><span class="o">/</span><span class="n">intermediates</span><span class="o">/</span><span class="n">ndk</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">NDK_LIBS_OUT</span><span class="o">=</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">jniLibs</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">APP_BUILD_SCRIPT</span><span class="o">=</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">jni</span><span class="o">/</span><span class="n">Android</span><span class="o">.</span><span class="na">mk</span><span class="err">&#39;</span><span class="o">,</span>
</span><span class="line">                <span class="err">&#39;</span><span class="n">NDK_APPLICATION_MK</span><span class="o">=</span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">jni</span><span class="o">/</span><span class="n">Application</span><span class="o">.</span><span class="na">mk</span><span class="err">&#39;</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">JavaCompile</span><span class="o">)</span> <span class="o">{</span>
</span><span class="line">        <span class="n">compileTask</span> <span class="o">-&gt;</span> <span class="n">compileTask</span><span class="o">.</span><span class="na">dependsOn</span> <span class="n">ndkBuild</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">    <span class="c1">// add end</span>
</span><span class="line">
</span><span class="line">    <span class="n">buildTypes</span> <span class="o">{</span>
</span><span class="line">        <span class="n">release</span> <span class="o">{</span>
</span><span class="line">            <span class="n">runProguard</span> <span class="kc">false</span>
</span><span class="line">            <span class="n">proguardFiles</span> <span class="nf">getDefaultProguardFile</span><span class="o">(</span><span class="err">&#39;</span><span class="n">proguard</span><span class="o">-</span><span class="n">android</span><span class="o">.</span><span class="na">txt</span><span class="err">&#39;</span><span class="o">),</span> <span class="err">&#39;</span><span class="n">proguard</span><span class="o">-</span><span class="n">rules</span><span class="o">.</span><span class="na">pro</span><span class="err">&#39;</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span><span class="line">
</span><span class="line"><span class="n">dependencies</span> <span class="o">{</span>
</span><span class="line">    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">include:</span> <span class="o">[</span><span class="err">&#39;</span><span class="o">*.</span><span class="na">jar</span><span class="err">&#39;</span><span class="o">])</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>So simple, right? <code>'NDK_LIBS_OUT=src/main/jniLibs'</code> helps us do the right job!</p>

<p>For testing, you can also add some lines relating with OpenCV in your <code>Android.mk</code> file and some line in your <code>main.c</code> to check whether everything is readlly working. For example, add <code>#include &lt;opencv2/core/core.hpp&gt;</code> in <code>main.c</code> file, and change  <code>Android.mk</code> to </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="java"><span class="line"><span class="n">LOCAL_PATH</span> <span class="o">:=</span> <span class="n">$</span><span class="o">(</span><span class="n">call</span> <span class="n">my</span><span class="o">-</span><span class="n">dir</span><span class="o">)</span>
</span><span class="line">
</span><span class="line"><span class="n">include</span> <span class="n">$</span><span class="o">(</span><span class="n">CLEAR_VARS</span><span class="o">)</span>
</span><span class="line">
</span><span class="line"><span class="err">#</span><span class="n">opencv</span>
</span><span class="line"><span class="nl">OPENCVROOT:</span><span class="o">=</span> <span class="o">/</span><span class="n">Volumes</span><span class="o">/</span><span class="n">hujiawei</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">hujiawei</span><span class="o">/</span><span class="n">Android</span><span class="o">/</span><span class="n">opencv_sdk</span>
</span><span class="line"><span class="nl">OPENCV_CAMERA_MODULES:</span><span class="o">=</span><span class="n">on</span>
</span><span class="line"><span class="nl">OPENCV_INSTALL_MODULES:</span><span class="o">=</span><span class="n">on</span>
</span><span class="line"><span class="nl">OPENCV_LIB_TYPE:</span><span class="o">=</span><span class="n">SHARED</span>
</span><span class="line"><span class="n">include</span> <span class="n">$</span><span class="o">{</span><span class="n">OPENCVROOT</span><span class="o">}/</span><span class="n">sdk</span><span class="o">/</span><span class="kd">native</span><span class="o">/</span><span class="n">jni</span><span class="o">/</span><span class="n">OpenCV</span><span class="o">.</span><span class="na">mk</span>
</span><span class="line">
</span><span class="line"><span class="n">LOCAL_SRC_FILES</span> <span class="o">:=</span> <span class="n">main</span><span class="o">.</span><span class="na">c</span>
</span><span class="line"><span class="n">LOCAL_LDLIBS</span> <span class="o">+=</span> <span class="o">-</span><span class="n">llog</span>
</span><span class="line"><span class="n">LOCAL_MODULE</span> <span class="o">:=</span> <span class="n">hello</span>
</span><span class="line">
</span><span class="line"><span class="n">include</span> <span class="n">$</span><span class="o">(</span><span class="n">BUILD_SHARED_LIBRARY</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In Gradle Console window, you can see these similar lines</p>

<p><img src="http://hujiaweibujidao.github.io/images/ndkdemo_gradle.png" alt="image" /></p>

<p><code>*.so</code> files relating with OpenCV has been packaged into the final APK</p>

<p><img src="http://hujiaweibujidao.github.io/images/ndkdemo_opencvlibs.png" alt="image" /></p>

<h4 id="one-more-thing"><strong>One More Thing</strong></h4>

<p>Of course, maybe you don’t want to change your <code>build.grale</code> file with that much code, and Of course, you also don’t want to run <code>ndk-build</code> outside the IDE, then copy the <code>&lt;abi&gt;/*.so</code> files into <code>jniLibs</code> folder each time you want to rebuild the native codes!</p>

<p>At last, I came out another nicer solution, if you like, that is to create a <code>ndk-build</code> external tool in Android Studio, and every time you want to rebuild the native codes, simply run the external tool, then it automatically generates the <code>libs/&lt;abi&gt;/*.so</code> files into <code>jniLibs</code> folder, so everything is ready to run this app, :-)</p>

<p>The configuration is simple</p>

<p>Parameters:  <code>NDK_PROJECT_PATH=$ModuleFileDir$/build/intermediates/ndk NDK_LIBS_OUT=$ModuleFileDir$/src/main/jniLibs NDK_APPLICATION_MK=$ModuleFileDir$/src/main/jni/Application.mk APP_BUILD_SCRIPT=$ModuleFileDir$/src/main/jni/Android.mk V=1</code></p>

<p><img src="http://hujiaweibujidao.github.io/images/ndk_build_as.png" alt="image" /></p>

<p>OK, I hope it is helpful. Let me know if it is really helpful, or tell me what’s your problem. :-)</p>

<p class="post-footer">
                        Original link:<a href="http://hujiaweibujidao.github.io/blog/2014/10/22/android-ndk-and-opencv-development-with-android-studio/">http://hujiaweibujidao.github.io/blog/2014/10/22/android-ndk-and-opencv-development-with-android-studio/</a><br />Written by <a href="http://hujiaweibujidao.github.io">hujiawei</a>&nbsp;Posted at <a href="http://hujiaweibujidao.github.io">http://hujiaweibujidao.github.io</a><br />Feel free to read or comment it, and if you want to copy it into your own site, please copy it with its Original Link showed above or you can see the license below for more details.If you have any problem or suggestion, please comment below. :-)<br />Thanks a lot. Hope you enjoy here! :-)</p>
</div>


		<footer>
			<p class="meta">
				
  

<span class="byline author vcard">Posted by <span class="fn">hujiawei</span></span>

				








  


<time datetime="2014-10-22T09:51:00+08:00" pubdate data-updated="true">Oct 22<span>nd</span>, 2014</time>
				

<span class="categories">
  
    <a class='category' href='/blog/categories/mobile/'>mobile</a>
  
</span>


			</p>
			
			<div class="sharing">
  
  
  
</div>

			
			<p class="meta">
				
				<a class="basic-alignment left" href="/blog/2014/10/15/gradle-plugin-user-guide-2/" title="Previous Post: Gradle Plugin for Android Development User Guide (2)">&laquo; Gradle Plugin for Android Development User Guide (2)</a>
				
				
			</p>
		</footer>
	</article>
	

	
	<section>
		<h1>Comments</h1>
		<div id="comments" aria-live="polite">
			<!-- Duoshuo Comment BEGIN   data-title=""-->
<div class="ds-thread"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"hujiaweibujidao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END -->

		</div>
	</section>
	
</div>

<aside class="sidebar">
  
	<section>
	<h1>关于博主</h1><br/>
  <a href="/aboutme/"><img src="/images/me-small.png" width="250px" height="210px" alt="protrait"/></a><br/>
  <p>Hi, I'm Hujiawei, from P.R.China. Now I'm a postgraduate student studying in <a href="http://www.tsinghua.edu.cn/publish/th/index.html">Tsinghua University</a>.
  Wanna know me? <a href="/aboutme/">See here.</a> 
  </p>
  
  <img src="/images/conan-mainperson.png" width="250px" height="210px" alt="conan"/>
  
  <br/>
  
  <a href="http://weibo.com/hujiaweiyinger"><img src="/images/sinaweibo.png" width="40px" height="40px"/></a> &nbsp;
  <a href="https://github.com/hujiaweibujidao"><img src="/images/github.png" width="40px" height="40px"/></a>&nbsp;
  <a href="http://hujiawei.tumblr.com"><img src="/images/tumblr.png" width="40px" height="40px"/></a> &nbsp;
  <a href="https://twitter.com/hujiaweiyinger"><img src="/images/twitter.png" width="40px" height="40px"/></a>&nbsp;
  <a href="http://www.douban.com/people/60272837/"><img src="/images/douban.png" width="40px" height="40px"/></a>
 
 <br/>
 <br/>
 <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=50&skin=1&isTitle=0&noborder=1&isWeibo=1&isFans=0&uid=1740244950&verifier=68702156&dpc=1"></iframe>
    <br/>
    <!--autoplay="autoplay" -->
    <!--
<audio width="200" height="32" 
style="margin: auto; top: 0; right: 0; bottom: 0; left: 0;" 
controls="controls" 
name="media" 
src="http://hujiaweibujidao.github.io/music/Wouldnt-It-Be-Nice.mp3">
</audio>
-->
  
  
  <!--baidu-->
  <!--
  <div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>  
-->

</section>
<section>
 <h1>分类目录</h1>
 <ul id="categories">
	 <li class='category'><a href='/blog/categories/algorithm/'>algorithm (18)</a></li>
<li class='category'><a href='/blog/categories/android/'>android (5)</a></li>
<li class='category'><a href='/blog/categories/hadoop/'>hadoop (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (1)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/machinelearning/'>machinelearning (2)</a></li>
<li class='category'><a href='/blog/categories/math/'>math (26)</a></li>
<li class='category'><a href='/blog/categories/matlab/'>matlab (1)</a></li>
<li class='category'><a href='/blog/categories/mobile/'>mobile (3)</a></li>
<li class='category'><a href='/blog/categories/mobiledev/'>mobiledev (5)</a></li>
<li class='category'><a href='/blog/categories/music/'>music (2)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (6)</a></li>
<li class='category'><a href='/blog/categories/opencv/'>opencv (5)</a></li>
<li class='category'><a href='/blog/categories/picture/'>picture (3)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (4)</a></li>

 </ul>
</section>
<section>
  <h1>近期文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/10/22/android-ndk-and-opencv-development-with-android-studio/">Android NDK and OpenCV Development With Android Studio</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/15/gradle-plugin-user-guide-2/">Gradle Plugin for Android Development User Guide (2)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/13/gradle-plugin-user-guide-1/">Gradle Plugin for Android Development User Guide (1)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/16/bootcamp-an-open-source-django-site/">Bootcamp an Open Source Django Site</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/12/download-coursera-courses-in-the-fastest-way/">Download Coursera Courses in the Fastest Way</a>
      </li>
    
  </ul>
  
  <h1>热评文章</h1>
<!-- 多说热评文章 start -->
	<div class="ds-top-threads" data-range="daily" data-num-items="5"></div>
<!-- 多说热评文章 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"hujiaweibujidao"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->

</section>
<section>
	<h1>好友博客</h1>
	<ul>
		<li>
			<a href="http://doufunao.github.io/">豆腐脑的幻想乡</a>
		</li>
		<li>
			<a href="http://c4fun.cn/">Code 4 Fun</a>
		</li>
		<li>
			<a href="http://www.tanglei.name/">TangLei blog</a>
		</li>
		<li>
			<a href="http://ontheroad.sinaapp.com/">Tian Jun-Find My Way</a>
		</li>
		
		<li>
			<a href="http://www.liaoxuefeng.com/">廖雪峰的官方网站</a>
		</li>
		<li>
			<a href="http://beader.me/">Beader</a>
		</li>
		<li>
			<a href="http://blog.csdn.net/v_JULY_v">结构之法，算法之道</a>
		</li>
				<li>
			<a href="http://www.renfei.org/blog/">Renfei Song</a>
		</li>
		<li>
			<a href="http://bluedavy.me">BlueDavy之技术blog</a>
		</li>
		<li>
			<a href="http://blog.jobbole.com/category/python/">伯乐在线-Python</a>
		</li>
		<li>
			<a href="http://www.douban.com/group/python/">豆瓣小组-Python</a>
		</li>
		<li>
			<a href="#">这里会是你吗?</a>
		</li>
	</ul>
</section>
	
</aside>


		</div>
	</div>
	
	<footer role="contentinfo">
		<p>
  	Copyright &copy; 2014 - hujiawei - <a href="http://hujiaweibujidao.github.io/happybirthday/">Happy birthday to MY QUEEN</a> - <span class="credit">Proudly Powered by <a href="http://octopress.org">Octopress</a></span>
  	

<!--baidu-->
<!--
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"1","bdPos":"left","bdTop":"250"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
-->

	<!-- CNZZ -->
	&nbsp;&nbsp;
	<script type="text/javascript">
		var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cspan id='cnzz_stat_icon_1000165127'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000165127%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
	</script>
	
	<!--baidu share-->
	<!--
	<div class="bdsharebuttonbox" style="display: inline;"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
	-->
	<!-- license -->
	<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/deed.zh"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nd/3.0/88x31.png" /></a>
	本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/deed.zh">知识共享署名-禁止演绎 3.0 未本地化版本许可协议</a>进行许可。

</p>

<!--hujiawei custom blockquote-->
<!--for block quote
<style>
blockquote{
	font:inherit;
	font-size:60%;
	font-style:normal;
	line-height:1.0em;
	color:rgba(0,0,0,0.5);
}
</style>-->

<!-- gutter for code line-numbers!! -->
<!--for block quote-->
<!--
<style>
blockquote{
	font:inherit;
	font-size:60%;
	font-style:normal;
	line-height:1.0em;
	color:rgba(0,0,0,0.5);
}

.gutter{
	display: none;
}

.highlight, .gist-highlight {
margin-bottom: 1.8em;
background: #002b36;
overflow-y: hidden;
overflow-x: auto;
}
</style>
-->

<!-- mathjax config similar to math.stackexchange  -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

<!-- the following line is incorrect! -->
<!--
<script type="text/javascript" src="https://stackedit.io/libs/MathJax/MathJax.js?config=TeX-AMS_HTML"></script>
-->



<!--return to top-->
<style>
	.returnTop {
		position: fixed;
		_position: absolute;
		right: 10px;
		bottom: 200px;
		_bottom: auto;
		display: none;
		width: 40px;
		height: 40px;
		border: 1px solid #61b72e;
		border-radius: 4px;
		background: #fff;
		box-shadow: 0 0 5px #F5F5F5;
		text-indent: -9999px;
		cursor: pointer;
	}
	.returnTop .s {
		position: absolute;
		top: -2px;
		_top: -20px;
		left: 10px;
		width: 0;
		height: 0;
		border-width: 10px;
		border-color: transparent transparent #61b72e;
		border-style: dashed dashed solid;
	}
	.returnTop .b {
		position: absolute;
		top: 18px;
		left: 16px;
		height: 12px;
		width: 8px;
		background: #61b72e;
	}
</style>
<div class="returnTop" title="嗖的就上去了！">
	<span class="s"></span>
	<span class="b"></span>
	返回顶部
</div>
<script type="text/javascript">
$(function(){
$(window).bind("scroll", function(){

var scrollTopNum = $(document).scrollTop(),
winHeight = $(window).height(),
returnTop = $("div.returnTop");

(scrollTopNum > 0) ? returnTop.fadeIn("fast") : returnTop.fadeOut("fast");

if (!-[1,]&&!window.XMLHttpRequest) {
returnTop.css("top", scrollTopNum + winHeight - 200);
}

});

$("div.returnTop").click(function() {
$("html, body").animate({ scrollTop: 0 }, 100);
});

});
</script>

	</footer>
	
	













</body>
</html>
