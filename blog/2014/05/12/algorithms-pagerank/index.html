
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Algorithms-PageRank - Hujiawei Bujidao</title>
  <meta name="author" content="hujiawei">

  
  <meta name="description" content="ML/DM/PR算法系列
逸夫图书馆, 2014/5/17 PageRank算法 PageRank算法是谷歌曾经独步天下的“倚天剑”，该算法由Larry Page和Sergey Brin在斯坦福大学读研时发明的，论文点击下载: The PageRank Citation Ranking: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hujiaweibujidao.github.io/blog/2014/05/12/algorithms-pagerank">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hujiawei Bujidao" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


  

</head>

<body   >

	<header role="banner">
		
<hgroup style="text-align: center">
	<h1><a href="/"><img src="/images/conan-paper-small.png"  />Hujiawei Bujidao<img src="/images/conan-hat-small.png"  /></a></h1>
	
	<h2>I will always be your savior! A secret makes a man man!</h2>
	
</hgroup>


	</header>
	<nav role="navigation">
		<ul class="subscription" data-subscription="rss">
  <!--<li><a href="https://github.com/hujiaweibujidao" rel="subscribe-rss" title="subscribe via RSS">View me on GitHub</a></li>-->
  <!--
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
  --> 
</ul>
<!--
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hujiaweibujidao.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form> 
  
-->
<ul class="main-navigation">
  <li><a href="/blog/archives/">Blog</a></li>
  <li><a href="/aboutme/">AboutMe</a></li>
  <li><a href="/math/">Math</a></li>
  <li><a href="/python/">Python</a></li>
  <li><a href="/datamining/">ML-DM-PR</a></li>
  <li><a href="/blog/categories/mobiledev/">MobileDev</a></li>
  <!--
  <li><a href="/xjava/">XJava</a></li>
  -->
  <!-- <li><a href="/datamining/">Projects</a></li> -->
</ul>


	</nav>
	<div id="main">
		<div id="content">
			<div>

<article class="hentry" role="article">
		
  <header>
    
      <h1 class="entry-title">Algorithms-PageRank</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-12T18:12:00+08:00" pubdate data-updated="true">May 12<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><strong><center>ML/DM/PR算法系列</center></strong>
<strong><center>逸夫图书馆, 2014/5/17</center></strong></p>

<h3 id="centerpagerankcenter"><center>PageRank算法</center></h3>

<p>PageRank算法是谷歌曾经独步天下的“倚天剑”，该算法由Larry Page和Sergey Brin在斯坦福大学读研时发明的，<a href="http://ilpubs.stanford.edu:8090/422/1/1999-66.pdf">论文点击下载: The PageRank Citation Ranking: Bringing Order to the Web</a>。</p>

<p>本文首先通过一些参考文献引出问题，然后给出了PageRank的几种实现算法，最后将其推广至在MapReduce框架下如何实现PageRank算法。</p>

<p>PageRank的核心思想有2点：</p>

<p>1.如果一个网页被很多其他网页链接到的话说明这个网页比较重要，也就是pagerank值会相对较高；</p>

<p>2.如果一个pagerank值很高的网页链接到一个其他的网页，那么被链接到的网页的pagerank值会相应地因此而提高。</p>

<p>下面是一张来自<a href="http://en.wikipedia.org/wiki/PageRank">WikiPedia</a>的图，每个球代表一个网页，球的大小反应了网页的pagerank值的大小。指向网页B和网页E的链接很多，所以B和E的pagerank值较高，另外，虽然很少有网页指向C，但是最重要的网页B指向了C，所以C的pagerank值比E还要大。</p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pagerank-fig.png" alt="image" /></p>

<p>参考内容：</p>

<p>1.<a href="http://en.wikipedia.org/wiki/PageRank">Wiki about PageRank</a></p>

<p>2.<a href="http://www.itlearner.com/good/pagerank_cn.htm">Google 的秘密- PageRank 彻底解说 中文版</a></p>

<p>3.<a href="http://book.douban.com/subject/7161824/">数值分析与算法</a> Page 161 应用实例：Google的PageRank算法</p>

<p>4.<a href="http://www.mathworks.cn/moler/chapters.html">Numeric Methods with Matlab</a> 或者<a href="http://book.douban.com/subject/1836464/">中文翻译版本Matlab数值计算</a></p>

<p>5.<a href="http://www.chenjunlu.com/2012/10/pagerank-on-mapreduce/">使用 MapReduce 思想计算 PageRank</a> Page 62 PageRank和马尔可夫链</p>

<h3 id="section">1.问题背景</h3>

<p>来自参考内容3</p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pk-1.png" alt="image" /></p>

<h3 id="section-1">2.数学建模</h3>

<p>来自参考内容3，理解网页连接矩阵$G$，马尔科夫过程(“网上冲浪”)，转移矩阵$A$，概率$p$为用户点击当前网页中的某个链接地址的概率(一般都为0.85)。</p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pk-2.png" alt="image" />
<img src="http://hujiaweibujidao.github.io/images/algos/pk-3.png" alt="image" /></p>

<p>最后得到一个等式$Ax=x$，这实际上就是求矩阵$A$的特征值为1的特征向量！</p>

<p>下面的内容使用圆盘定理解释了1是矩阵$A$的主特征值，所以我们可以使用幂法来求解。</p>

<p>关于幂法的详细介绍参考另一篇文章<a href="http://hujiaweibujidao.github.io/blog/2014/04/23/numerical-methods-using-matlab/">Numerical Methods Using Matlab: 第三章 矩阵特征值和奇异值求解</a></p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pk-4.png" alt="image" />
<img src="http://hujiaweibujidao.github.io/images/algos/pk-5.png" alt="image" /></p>

<!--
![image](http://hujiaweibujidao.github.io/images/algos/pk-6.png)
-->

<h3 id="pagerank">3.求解PageRank</h3>

<p>假设有如上图右侧所示的网页链接模型。</p>

<p>(1) 幂法</p>

<p>wiki上有一个PageRank的简便算法，它不考虑转移概率，而是采用的是迭代的方式，每次都更新所有网页的pagerank值，更新的方式就是将每个网页的pagerank值平摊分给它指向的所有网页，每个网页累计所有指向它的网页平摊给它的值作为它该回合的pagerank值，直到全部网页的pagerank值收敛了或者满足一定的阈值条件就停止。</p>

<p>后面的MapReduce框架下PageRank算法的实现就采用了这个思想。考虑转移概率的情况和这个算法类似，乘上一个转移概率再加上一个随机跳转的概率。</p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pagerank-Simplified-algorithm.png" alt="image" /></p>

<p>根据上面的思想，下面Matlab代码实现可以得到各个网页的PageRank值。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="matlab"><span class="line"><span class="n">n</span><span class="p">=</span>6<span class="p">;</span>
</span><span class="line"><span class="nb">i</span><span class="p">=[</span>2 3 4 4 5 6 1 6 1<span class="p">];</span>
</span><span class="line"><span class="nb">j</span><span class="p">=[</span>1 2 2 3 3 3 4 5 6<span class="p">];</span>
</span><span class="line"><span class="n">G</span><span class="p">=</span><span class="n">sparse</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">,</span>1<span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="c">% Power method</span>
</span><span class="line"><span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 1<span class="p">:</span><span class="n">n</span>
</span><span class="line">   <span class="n">L</span><span class="p">{</span><span class="nb">j</span><span class="p">}</span> <span class="p">=</span> <span class="nb">find</span><span class="p">(</span><span class="n">G</span><span class="p">(:,</span><span class="nb">j</span><span class="p">));</span>
</span><span class="line">   <span class="n">c</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="p">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">L</span><span class="p">{</span><span class="nb">j</span><span class="p">});</span>
</span><span class="line"><span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="n">p</span> <span class="p">=</span> <span class="p">.</span>85<span class="p">;</span>
</span><span class="line"><span class="n">delta</span> <span class="p">=</span> <span class="p">(</span>1<span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
</span><span class="line"><span class="n">x</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span>1<span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
</span><span class="line"><span class="n">z</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span>1<span class="p">);</span>
</span><span class="line"><span class="n">cnt</span> <span class="p">=</span> 0<span class="p">;</span>
</span><span class="line"><span class="k">while</span> <span class="n">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">z</span><span class="p">))</span> <span class="o">&gt;</span> <span class="p">.</span>0001
</span><span class="line">   <span class="n">z</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span>
</span><span class="line">   <span class="n">x</span> <span class="p">=</span> <span class="nb">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span>1<span class="p">);</span>
</span><span class="line">   <span class="k">for</span> <span class="nb">j</span> <span class="p">=</span> 1<span class="p">:</span><span class="n">n</span>
</span><span class="line">      <span class="k">if</span> <span class="n">c</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span> <span class="o">==</span> 0
</span><span class="line">         <span class="n">x</span> <span class="p">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span><span class="c">%转移到任意一个网页</span>
</span><span class="line">      <span class="k">else</span>
</span><span class="line">         <span class="n">x</span><span class="p">(</span><span class="n">L</span><span class="p">{</span><span class="nb">j</span><span class="p">})</span> <span class="p">=</span> <span class="n">x</span><span class="p">(</span><span class="n">L</span><span class="p">{</span><span class="nb">j</span><span class="p">})</span> <span class="o">+</span> <span class="n">z</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">(</span><span class="nb">j</span><span class="p">);</span><span class="c">%将上次的pagerank值平摊给所有指向的网页</span>
</span><span class="line">      <span class="k">end</span>
</span><span class="line">   <span class="k">end</span>
</span><span class="line">   <span class="n">x</span> <span class="p">=</span> <span class="n">p</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">delta</span><span class="p">;</span>
</span><span class="line">   <span class="n">cnt</span> <span class="p">=</span> <span class="n">cnt</span><span class="o">+</span>1<span class="p">;</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
<p>得到的向量$x$保存了各个网页的pagerank值，虽然链接数目一样，但是网页①比网页④和网页⑤都高，而网页②的pagerank值第二高，因为网页①链接到了它上面，相当于沾了网页①的光。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="matlab"><span class="line"><span class="n">x</span> <span class="p">=</span>
</span><span class="line">    0<span class="p">.</span>2675
</span><span class="line">    0<span class="p">.</span>2524
</span><span class="line">    0<span class="p">.</span>1323
</span><span class="line">    0<span class="p">.</span>1698
</span><span class="line">    0<span class="p">.</span>0625
</span><span class="line">    0<span class="p">.</span>1156
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><a href="http://www.chenjunlu.com/2012/09/pagerank-algorithm-implemented-in-python/">这篇文章给出该算法的一个Python版本实现</a>，该博主使用第三方模块<a href="https://code.google.com/p/python-graph/">python-graph</a>，python-graph模块实现了很多图算法，<a href="https://code.google.com/p/python-graph/wiki/Example">该模块的使用示例</a>，使用前需要先安装，代码如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">easy_install</span> <span class="n">python</span><span class="o">-</span><span class="n">graph</span><span class="o">-</span><span class="n">core</span>
</span><span class="line"><span class="n">easy_install</span> <span class="n">python</span><span class="o">-</span><span class="n">graph</span><span class="o">-</span><span class="n">dot</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Python版本的算法实现：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># coding=utf-8</span>
</span><span class="line">
</span><span class="line"><span class="c"># python-graph https://code.google.com/p/python-graph/</span>
</span><span class="line">
</span><span class="line"><span class="c"># Import graphviz</span>
</span><span class="line"><span class="kn">import</span> <span class="nn">graphviz</span> <span class="kn">as</span> <span class="nn">gv</span>
</span><span class="line">
</span><span class="line"><span class="c"># Import pygraph</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">pygraph.classes.digraph</span> <span class="kn">import</span> <span class="n">digraph</span>
</span><span class="line"><span class="kn">from</span> <span class="nn">pygraph.readwrite.dot</span> <span class="kn">import</span> <span class="n">write</span>
</span><span class="line">
</span><span class="line"><span class="c"># Define pagerank function</span>
</span><span class="line"><span class="k">def</span> <span class="nf">pagerank</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">damping_factor</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">max_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> \
</span><span class="line">             <span class="n">min_delta</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="line"><span class="sd">    Compute and return the PageRank in an directed graph.</span>
</span><span class="line">
</span><span class="line"><span class="sd">    @type  graph: digraph</span>
</span><span class="line"><span class="sd">    @param graph: Digraph.</span>
</span><span class="line">
</span><span class="line"><span class="sd">    @type  damping_factor: number</span>
</span><span class="line"><span class="sd">    @param damping_factor: PageRank dumping factor.</span>
</span><span class="line">
</span><span class="line"><span class="sd">    @type  max_iterations: number</span>
</span><span class="line"><span class="sd">    @param max_iterations: Maximum number of iterations.</span>
</span><span class="line">
</span><span class="line"><span class="sd">    @type  min_delta: number</span>
</span><span class="line"><span class="sd">    @param min_delta: Smallest variation required for a new iteration.</span>
</span><span class="line">
</span><span class="line"><span class="sd">    @rtype:  Dict</span>
</span><span class="line"><span class="sd">    @return: Dict containing all the nodes PageRank.</span>
</span><span class="line"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line">    <span class="n">nodes</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>
</span><span class="line">    <span class="n">graph_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">graph_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class="line">        <span class="k">return</span> <span class="p">{}</span>
</span><span class="line">    <span class="c"># value for nodes without inbound links</span>
</span><span class="line">    <span class="n">min_value</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">damping_factor</span><span class="p">)</span><span class="o">/</span><span class="n">graph_size</span>
</span><span class="line">
</span><span class="line">    <span class="c"># itialize the page rank dict with 1/N for all nodes</span>
</span><span class="line">    <span class="c">#pagerank = dict.fromkeys(nodes, 1.0/graph_size)</span>
</span><span class="line">    <span class="n">pagerank</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iterations</span><span class="p">):</span>
</span><span class="line">        <span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#total difference compared to last iteraction</span>
</span><span class="line">        <span class="c"># computes each node PageRank based on inbound links</span>
</span><span class="line">        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span class="line">            <span class="n">rank</span> <span class="o">=</span> <span class="n">min_value</span>
</span><span class="line">            <span class="k">for</span> <span class="n">referring_page</span> <span class="ow">in</span> <span class="n">graph</span><span class="o">.</span><span class="n">incidents</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span class="line">                <span class="n">rank</span> <span class="o">+=</span> <span class="n">damping_factor</span> <span class="o">*</span> <span class="n">pagerank</span><span class="p">[</span><span class="n">referring_page</span><span class="p">]</span> <span class="o">/</span> \
</span><span class="line">                        <span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="o">.</span><span class="n">neighbors</span><span class="p">(</span><span class="n">referring_page</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">            <span class="n">diff</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pagerank</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">rank</span><span class="p">)</span>
</span><span class="line">            <span class="n">pagerank</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">rank</span>
</span><span class="line">
</span><span class="line">        <span class="k">print</span> <span class="s">&#39;This is NO.</span><span class="si">%s</span><span class="s"> iteration&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span><span class="line">        <span class="k">print</span> <span class="n">pagerank</span>
</span><span class="line">        <span class="k">print</span> <span class="s">&#39;&#39;</span>
</span><span class="line">
</span><span class="line">        <span class="c">#stop if PageRank has converged</span>
</span><span class="line">        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">min_delta</span><span class="p">:</span>
</span><span class="line">            <span class="k">break</span>
</span><span class="line">
</span><span class="line">    <span class="k">return</span> <span class="n">pagerank</span>
</span><span class="line">
</span><span class="line"><span class="c"># Graph creation</span>
</span><span class="line"><span class="n">gr</span> <span class="o">=</span> <span class="n">digraph</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="c"># Add nodes and edges</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">([</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="s">&quot;3&quot;</span><span class="p">,</span><span class="s">&quot;4&quot;</span><span class="p">])</span>
</span><span class="line">
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;2&quot;</span><span class="p">))</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;3&quot;</span><span class="p">))</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;1&quot;</span><span class="p">,</span><span class="s">&quot;4&quot;</span><span class="p">))</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="s">&quot;3&quot;</span><span class="p">))</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;2&quot;</span><span class="p">,</span><span class="s">&quot;4&quot;</span><span class="p">))</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;3&quot;</span><span class="p">,</span><span class="s">&quot;4&quot;</span><span class="p">))</span>
</span><span class="line"><span class="n">gr</span><span class="o">.</span><span class="n">add_edge</span><span class="p">((</span><span class="s">&quot;4&quot;</span><span class="p">,</span><span class="s">&quot;2&quot;</span><span class="p">))</span>
</span><span class="line">
</span><span class="line"><span class="c"># Draw as PNG</span>
</span><span class="line"><span class="c"># dot = write(gr)</span>
</span><span class="line"><span class="c"># gvv = gv.readstring(dot)</span>
</span><span class="line"><span class="c"># gv.layout(gvv,&#39;dot&#39;)</span>
</span><span class="line"><span class="c"># gv.render(gvv,&#39;png&#39;,&#39;Model.png&#39;)</span>
</span><span class="line">
</span><span class="line"><span class="n">pagerank</span><span class="p">(</span><span class="n">gr</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>经过32次迭代之后得到的结果如下，和前面的结果一致：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">This</span> <span class="ow">is</span> <span class="n">NO</span><span class="o">.</span><span class="mi">32</span> <span class="n">iteration</span>
</span><span class="line"><span class="p">{</span><span class="s">&#39;1&#39;</span><span class="p">:</span> <span class="mf">0.2675338708706491</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">:</span> <span class="mf">0.13227261904986046</span><span class="p">,</span> <span class="s">&#39;2&#39;</span><span class="p">:</span> <span class="mf">0.2524037902400518</span><span class="p">,</span> <span class="s">&#39;5&#39;</span><span class="p">:</span> <span class="mf">0.062477242064127136</span><span class="p">,</span> <span class="s">&#39;4&#39;</span><span class="p">:</span> <span class="mf">0.1697488529161491</span><span class="p">,</span> <span class="s">&#39;6&#39;</span><span class="p">:</span> <span class="mf">0.1155828978186352</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>(2) 利用马尔可夫矩阵的特殊结构</p>

<p>来自参考内容4，其中$\delta=\frac{1-p}{n}$</p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pk-8.png" alt="image" /></p>

<p>也就是将矩阵$A$进行分解，并不需要显示求出矩阵$A$，然后便是求解一个线性方程组即可。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">function</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pagerank1</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</span><span class="line"><span class="o">%</span> <span class="n">PAGERANK1</span>  <span class="n">Google</span><span class="s">&#39;s PageRank modified version 1 - hujiawei</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span><span class="k">if</span> <span class="n">nargin</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="o">.</span><span class="mi">85</span><span class="p">;</span> <span class="n">end</span>
</span><span class="line"><span class="n">p</span><span class="o">=</span><span class="mf">0.85</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Eliminate</span> <span class="nb">any</span> <span class="bp">self</span><span class="o">-</span><span class="n">referential</span> <span class="n">links</span>
</span><span class="line">
</span><span class="line"><span class="n">G</span> <span class="o">=</span> <span class="n">G</span> <span class="o">-</span> <span class="n">diag</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">G</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">c</span> <span class="o">=</span> <span class="n">out</span><span class="o">-</span><span class="n">degree</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="ow">in</span><span class="o">-</span><span class="n">degree</span>
</span><span class="line">
</span><span class="line"><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
</span><span class="line"><span class="n">c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="o">%</span><span class="n">each</span> <span class="n">row</span><span class="s">&#39;s sum</span>
</span><span class="line"><span class="n">r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="o">%</span><span class="n">each</span> <span class="n">col</span><span class="s">&#39;s sum</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Scale</span> <span class="n">column</span> <span class="n">sums</span> <span class="n">to</span> <span class="n">be</span> <span class="mi">1</span> <span class="p">(</span><span class="ow">or</span> <span class="mi">0</span> <span class="n">where</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">out</span> <span class="n">links</span><span class="p">)</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="n">k</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="o">~=</span><span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">D</span> <span class="o">=</span> <span class="n">sparse</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Solve</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">e</span>
</span><span class="line">
</span><span class="line"><span class="n">e</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class="line"><span class="n">I</span> <span class="o">=</span> <span class="n">speye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
</span><span class="line"><span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">D</span><span class="p">)</span>\<span class="n">e</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Normalize</span> <span class="n">so</span> <span class="n">that</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.</span>
</span><span class="line">
</span><span class="line"><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>(3) 巧妙解法：逆迭代算法</p>

<p>巧妙利用Matlab中的精度误差导致原本是一个奇异矩阵的$I-A$变成一个非奇异矩阵，运行时只是会有些警告提示，但是运行结果和其他算法一样。</p>

<p><img src="http://hujiaweibujidao.github.io/images/algos/pk-9.png" alt="image" /></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">function</span> <span class="n">x</span> <span class="o">=</span> <span class="n">pagerank2</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</span><span class="line"><span class="o">%</span> <span class="n">PAGERANK1</span>  <span class="n">Google</span><span class="s">&#39;s PageRank modified version 2 - hujiawei</span>
</span><span class="line"><span class="o">%</span> <span class="n">using</span> <span class="n">inverse</span> <span class="n">iteration</span> <span class="n">method</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span><span class="k">if</span> <span class="n">nargin</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="o">.</span><span class="mi">85</span><span class="p">;</span> <span class="n">end</span>
</span><span class="line"><span class="n">p</span><span class="o">=</span><span class="mf">0.85</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Eliminate</span> <span class="nb">any</span> <span class="bp">self</span><span class="o">-</span><span class="n">referential</span> <span class="n">links</span>
</span><span class="line">
</span><span class="line"><span class="n">G</span> <span class="o">=</span> <span class="n">G</span> <span class="o">-</span> <span class="n">diag</span><span class="p">(</span><span class="n">diag</span><span class="p">(</span><span class="n">G</span><span class="p">));</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">c</span> <span class="o">=</span> <span class="n">out</span><span class="o">-</span><span class="n">degree</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="ow">in</span><span class="o">-</span><span class="n">degree</span>
</span><span class="line">
</span><span class="line"><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
</span><span class="line"><span class="n">c</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="o">%</span><span class="n">each</span> <span class="n">row</span><span class="s">&#39;s sum</span>
</span><span class="line"><span class="n">r</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span><span class="o">%</span><span class="n">each</span> <span class="n">col</span><span class="s">&#39;s sum</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Scale</span> <span class="n">column</span> <span class="n">sums</span> <span class="n">to</span> <span class="n">be</span> <span class="mi">1</span> <span class="p">(</span><span class="ow">or</span> <span class="mi">0</span> <span class="n">where</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">out</span> <span class="n">links</span><span class="p">)</span><span class="o">.</span>
</span><span class="line">
</span><span class="line"><span class="n">k</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">c</span><span class="o">~=</span><span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">D</span> <span class="o">=</span> <span class="n">sparse</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="mf">1.</span><span class="o">/</span><span class="n">c</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Solve</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="n">e</span>
</span><span class="line">
</span><span class="line"><span class="n">e</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class="line"><span class="n">I</span> <span class="o">=</span> <span class="n">speye</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
</span><span class="line"><span class="o">%</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">-</span> <span class="n">p</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">D</span><span class="p">)</span>\<span class="n">e</span><span class="p">;</span>
</span><span class="line"><span class="n">delta</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
</span><span class="line"><span class="n">A</span><span class="o">=</span><span class="n">p</span><span class="o">*</span><span class="n">G</span><span class="o">*</span><span class="n">D</span><span class="o">+</span><span class="n">delta</span><span class="p">;</span>
</span><span class="line"><span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>\<span class="n">e</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Normalize</span> <span class="n">so</span> <span class="n">that</span> <span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.</span>
</span><span class="line">
</span><span class="line"><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>最后，附上参考内容4中给出的一份好代码，用于模拟随机冲浪生成矩阵$G$的代码</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">function</span> <span class="p">[</span><span class="n">U</span><span class="p">,</span><span class="n">G</span><span class="p">]</span> <span class="o">=</span> <span class="n">surfer</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</span><span class="line"><span class="o">%</span> <span class="n">SURFER</span>  <span class="n">Create</span> <span class="n">the</span> <span class="n">adjacency</span> <span class="n">graph</span> <span class="n">of</span> <span class="n">a</span> <span class="n">portion</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Web</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>    <span class="p">[</span><span class="n">U</span><span class="p">,</span><span class="n">G</span><span class="p">]</span> <span class="o">=</span> <span class="n">surfer</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="n">starts</span> <span class="n">at</span> <span class="n">the</span> <span class="n">URL</span> <span class="n">root</span> <span class="ow">and</span> <span class="n">follows</span>
</span><span class="line"><span class="o">%</span>    <span class="n">Web</span> <span class="n">links</span> <span class="n">until</span> <span class="n">it</span> <span class="n">forms</span> <span class="n">an</span> <span class="n">adjacency</span> <span class="n">graph</span> <span class="k">with</span> <span class="n">n</span> <span class="n">nodes</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>    <span class="n">U</span> <span class="o">=</span> <span class="n">a</span> <span class="n">cell</span> <span class="n">array</span> <span class="n">of</span> <span class="n">n</span> <span class="n">strings</span><span class="p">,</span> <span class="n">the</span> <span class="n">URLs</span> <span class="n">of</span> <span class="n">the</span> <span class="n">nodes</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>    <span class="n">G</span> <span class="o">=</span> <span class="n">an</span> <span class="n">n</span><span class="o">-</span><span class="n">by</span><span class="o">-</span><span class="n">n</span> <span class="n">sparse</span> <span class="n">matrix</span> <span class="k">with</span> <span class="n">G</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="n">node</span> <span class="n">j</span> <span class="ow">is</span> <span class="n">linked</span> <span class="n">to</span> <span class="n">node</span> <span class="n">i</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>
</span><span class="line"><span class="o">%</span>    <span class="n">Example</span><span class="p">:</span>  <span class="p">[</span><span class="n">U</span><span class="p">,</span><span class="n">G</span><span class="p">]</span> <span class="o">=</span> <span class="n">surfer</span><span class="p">(</span><span class="s">&#39;http://www.harvard.edu&#39;</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span>
</span><span class="line"><span class="o">%</span>    <span class="n">See</span> <span class="n">also</span> <span class="n">PAGERANK</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>
</span><span class="line"><span class="o">%</span>    <span class="n">This</span> <span class="n">function</span> <span class="n">currently</span> <span class="n">has</span> <span class="n">two</span> <span class="n">defects</span><span class="o">.</span>  <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">The</span> <span class="n">algorithm</span> <span class="k">for</span>
</span><span class="line"><span class="o">%</span>    <span class="n">finding</span> <span class="n">links</span> <span class="ow">is</span> <span class="n">naive</span><span class="o">.</span>  <span class="n">We</span> <span class="n">just</span> <span class="n">look</span> <span class="k">for</span> <span class="n">the</span> <span class="n">string</span> <span class="s">&#39;http:&#39;</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>    <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="n">An</span> <span class="n">attempt</span> <span class="n">to</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">a</span> <span class="nn">URL</span> <span class="nn">that</span> <span class="nn">is</span> <span class="nn">accessible</span><span class="p">,</span> <span class="n">but</span> <span class="n">very</span> <span class="n">slow</span><span class="p">,</span>
</span><span class="line"><span class="o">%</span>    <span class="n">might</span> <span class="n">take</span> <span class="n">an</span> <span class="n">unacceptably</span> <span class="nb">long</span> <span class="n">time</span> <span class="n">to</span> <span class="n">complete</span><span class="o">.</span>  <span class="n">In</span> <span class="n">some</span> <span class="n">cases</span><span class="p">,</span>
</span><span class="line"><span class="o">%</span>    <span class="n">it</span> <span class="n">may</span> <span class="n">be</span> <span class="n">necessary</span> <span class="n">to</span> <span class="n">have</span> <span class="n">the</span> <span class="n">operating</span> <span class="n">system</span> <span class="n">terminate</span> <span class="n">MATLAB</span><span class="o">.</span>
</span><span class="line"><span class="o">%</span>    <span class="n">Key</span> <span class="n">words</span> <span class="kn">from</span> <span class="nn">such</span> <span class="nn">URLs</span> <span class="nn">can</span> <span class="nn">be</span> <span class="nn">added</span> <span class="nn">to</span> <span class="nn">the</span> <span class="nn">skip</span> <span class="nn">list</span> <span class="nn">in</span> <span class="nn">surfer.m.</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Initialize</span>
</span><span class="line">
</span><span class="line"><span class="n">clf</span>
</span><span class="line"><span class="n">shg</span>
</span><span class="line"><span class="nb">set</span><span class="p">(</span><span class="n">gcf</span><span class="p">,</span><span class="s">&#39;doublebuffer&#39;</span><span class="p">,</span><span class="s">&#39;on&#39;</span><span class="p">)</span>
</span><span class="line"><span class="n">axis</span><span class="p">([</span><span class="mi">0</span> <span class="n">n</span> <span class="mi">0</span> <span class="n">n</span><span class="p">])</span>
</span><span class="line"><span class="n">axis</span> <span class="n">square</span>
</span><span class="line"><span class="n">axis</span> <span class="n">ij</span>
</span><span class="line"><span class="n">box</span> <span class="n">on</span>
</span><span class="line"><span class="nb">set</span><span class="p">(</span><span class="n">gca</span><span class="p">,</span><span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mi">12</span> <span class="o">.</span><span class="mi">20</span> <span class="o">.</span><span class="mi">78</span> <span class="o">.</span><span class="mi">78</span><span class="p">])</span>
</span><span class="line"><span class="n">uicontrol</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span><span class="s">&#39;frame&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mo">01</span> <span class="o">.</span><span class="mi">09</span> <span class="o">.</span><span class="mi">98</span> <span class="o">.</span><span class="mo">07</span><span class="p">]);</span>
</span><span class="line"><span class="n">uicontrol</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span><span class="s">&#39;frame&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mo">01</span> <span class="o">.</span><span class="mo">01</span> <span class="o">.</span><span class="mi">98</span> <span class="o">.</span><span class="mo">07</span><span class="p">]);</span>
</span><span class="line"><span class="n">t1</span> <span class="o">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mo">02</span> <span class="o">.</span><span class="mi">10</span> <span class="o">.</span><span class="mi">94</span> <span class="o">.</span><span class="mo">04</span><span class="p">],</span> <span class="o">...</span>
</span><span class="line">   <span class="s">&#39;horiz&#39;</span><span class="p">,</span><span class="s">&#39;left&#39;</span><span class="p">);</span>
</span><span class="line"><span class="n">t2</span> <span class="o">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">,</span><span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mo">02</span> <span class="o">.</span><span class="mo">02</span> <span class="o">.</span><span class="mi">94</span> <span class="o">.</span><span class="mo">04</span><span class="p">],</span> <span class="o">...</span>
</span><span class="line">   <span class="s">&#39;horiz&#39;</span><span class="p">,</span><span class="s">&#39;left&#39;</span><span class="p">);</span>
</span><span class="line"><span class="n">slow</span> <span class="o">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span><span class="s">&#39;toggle&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="o">...</span>
</span><span class="line">   <span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mo">01</span> <span class="o">.</span><span class="mi">24</span> <span class="o">.</span><span class="mo">07</span> <span class="o">.</span><span class="mo">05</span><span class="p">],</span><span class="s">&#39;string&#39;</span><span class="p">,</span><span class="s">&#39;slow&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="n">quit</span> <span class="o">=</span> <span class="n">uicontrol</span><span class="p">(</span><span class="s">&#39;style&#39;</span><span class="p">,</span><span class="s">&#39;toggle&#39;</span><span class="p">,</span><span class="s">&#39;units&#39;</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="o">...</span>
</span><span class="line">   <span class="s">&#39;position&#39;</span><span class="p">,[</span><span class="o">.</span><span class="mo">01</span> <span class="o">.</span><span class="mi">17</span> <span class="o">.</span><span class="mo">07</span> <span class="o">.</span><span class="mo">05</span><span class="p">],</span><span class="s">&#39;string&#39;</span><span class="p">,</span><span class="s">&#39;quit&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="n">U</span> <span class="o">=</span> <span class="n">cell</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class="line"><span class="nb">hash</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class="line"><span class="n">G</span> <span class="o">=</span> <span class="n">logical</span><span class="p">(</span><span class="n">sparse</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">));</span>
</span><span class="line"><span class="n">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="n">U</span><span class="p">{</span><span class="n">m</span><span class="p">}</span> <span class="o">=</span> <span class="n">root</span><span class="p">;</span>
</span><span class="line"><span class="nb">hash</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">hashfun</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="n">get</span><span class="p">(</span><span class="n">quit</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class="line">
</span><span class="line">   <span class="o">%</span> <span class="n">Try</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">a</span> <span class="n">page</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">   <span class="k">try</span>
</span><span class="line">      <span class="nb">set</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">,</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%5d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">U</span><span class="p">{</span><span class="n">j</span><span class="p">}))</span>
</span><span class="line">      <span class="nb">set</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">);</span>
</span><span class="line">      <span class="n">drawnow</span>
</span><span class="line">      <span class="n">page</span> <span class="o">=</span> <span class="n">urlread</span><span class="p">(</span><span class="n">U</span><span class="p">{</span><span class="n">j</span><span class="p">});</span>
</span><span class="line">   <span class="n">catch</span>
</span><span class="line">      <span class="nb">set</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="s">&#39;string&#39;</span><span class="p">,</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;fail: </span><span class="si">%5d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">U</span><span class="p">{</span><span class="n">j</span><span class="p">}))</span>
</span><span class="line">      <span class="n">drawnow</span>
</span><span class="line">      <span class="k">continue</span>
</span><span class="line">   <span class="n">end</span>
</span><span class="line">   <span class="k">if</span> <span class="n">get</span><span class="p">(</span><span class="n">slow</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
</span><span class="line">      <span class="n">pause</span><span class="p">(</span><span class="o">.</span><span class="mi">25</span><span class="p">)</span>
</span><span class="line">   <span class="n">end</span>
</span><span class="line">
</span><span class="line">   <span class="o">%</span> <span class="n">Follow</span> <span class="n">the</span> <span class="n">links</span> <span class="kn">from</span> <span class="nn">the</span> <span class="nn">open</span> <span class="nn">page.</span>
</span><span class="line">
</span><span class="line">   <span class="k">for</span> <span class="n">f</span> <span class="o">=</span> <span class="n">findstr</span><span class="p">(</span><span class="s">&#39;http:&#39;</span><span class="p">,</span><span class="n">page</span><span class="p">);</span>
</span><span class="line">
</span><span class="line">      <span class="o">%</span> <span class="n">A</span> <span class="n">link</span> <span class="n">starts</span> <span class="k">with</span> <span class="s">&#39;http:&#39;</span> <span class="ow">and</span> <span class="n">ends</span> <span class="k">with</span> <span class="n">the</span> <span class="nb">next</span> <span class="n">quote</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">      <span class="n">e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">findstr</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">page</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">end</span><span class="p">))</span> <span class="n">findstr</span><span class="p">(</span><span class="s">&#39;&#39;&#39;&#39;,page(f:end))]);</span>
</span><span class="line"><span class="s">      if isempty(e), continue, end</span>
</span><span class="line"><span class="s">      url = deblank(page(f:f+e-2));</span>
</span><span class="line"><span class="s">      url(url&lt;&#39; &#39;) = &#39;!&#39;;   % Nonprintable characters</span>
</span><span class="line"><span class="s">      if url(end) == &#39;/&#39;, url(end) = []; end</span>
</span><span class="line">
</span><span class="line"><span class="s">      </span><span class="si">% Lo</span><span class="s">ok for links that should be skipped.</span>
</span><span class="line">
</span><span class="line"><span class="s">      skips = {&#39;.gif&#39;,&#39;.jpg&#39;,&#39;.pdf&#39;,&#39;.css&#39;,&#39;lmscadsi&#39;,&#39;cybernet&#39;, ...</span>
</span><span class="line"><span class="s">               &#39;search.cgi&#39;,&#39;.ram&#39;,&#39;www.w3.org&#39;, ...</span>
</span><span class="line"><span class="s">               &#39;scripts&#39;,&#39;netscape&#39;,&#39;shockwave&#39;,&#39;webex&#39;,&#39;fansonly&#39;};</span>
</span><span class="line"><span class="s">      skip = any(url==&#39;!&#39;) | any(url==&#39;?&#39;);</span>
</span><span class="line"><span class="s">      k = 0;</span>
</span><span class="line"><span class="s">      while ~skip &amp; (k &lt; length(skips))</span>
</span><span class="line"><span class="s">         k = k+1;</span>
</span><span class="line"><span class="s">         skip = ~isempty(findstr(url,skips{k}));</span>
</span><span class="line"><span class="s">      end</span>
</span><span class="line"><span class="s">      if skip</span>
</span><span class="line"><span class="s">         if isempty(findstr(url,&#39;.gif&#39;)) &amp; isempty(findstr(url,&#39;.jpg&#39;))</span>
</span><span class="line"><span class="s">            set(t2,&#39;string&#39;,sprintf(&#39;skip: </span><span class="si">%s</span><span class="s">&#39;,url))</span>
</span><span class="line"><span class="s">            drawnow</span>
</span><span class="line"><span class="s">            if get(slow,&#39;value&#39;)</span>
</span><span class="line"><span class="s">               pause(.25)</span>
</span><span class="line"><span class="s">            end</span>
</span><span class="line"><span class="s">         end</span>
</span><span class="line"><span class="s">         continue</span>
</span><span class="line"><span class="s">      end</span>
</span><span class="line">
</span><span class="line"><span class="s">      % Check if page is already in url list.</span>
</span><span class="line">
</span><span class="line"><span class="s">      i = 0;</span>
</span><span class="line"><span class="s">      for k = find(hash(1:m) == hashfun(url))&#39;;</span>
</span><span class="line"><span class="s">         if isequal(U{k},url)</span>
</span><span class="line"><span class="s">            i = k;</span>
</span><span class="line"><span class="s">            break</span>
</span><span class="line"><span class="s">         end</span>
</span><span class="line"><span class="s">      end</span>
</span><span class="line">
</span><span class="line"><span class="s">      % Add a new url to the graph there if are fewer than n.</span>
</span><span class="line">
</span><span class="line"><span class="s">      if (i == 0) &amp; (m &lt; n)</span>
</span><span class="line"><span class="s">         m = m+1;</span>
</span><span class="line"><span class="s">         U{m} = url;</span>
</span><span class="line"><span class="s">         hash(m) = hashfun(url);</span>
</span><span class="line"><span class="s">         i = m;</span>
</span><span class="line"><span class="s">      end</span>
</span><span class="line">
</span><span class="line"><span class="s">      % Add a new link.</span>
</span><span class="line">
</span><span class="line"><span class="s">      if i &gt; 0</span>
</span><span class="line"><span class="s">         G(i,j) = 1;</span>
</span><span class="line"><span class="s">         set(t2,&#39;string&#39;,sprintf(&#39;</span><span class="si">%5d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;,i,url))</span>
</span><span class="line"><span class="s">         line(j,i,&#39;marker&#39;,&#39;.&#39;,&#39;markersize&#39;,6)</span>
</span><span class="line"><span class="s">         drawnow</span>
</span><span class="line"><span class="s">         if get(slow,&#39;value&#39;)</span>
</span><span class="line"><span class="s">            pause(.25)</span>
</span><span class="line"><span class="s">         end</span>
</span><span class="line"><span class="s">      end</span>
</span><span class="line"><span class="s">   end</span>
</span><span class="line">
</span><span class="line"><span class="s">   j = j+1;</span>
</span><span class="line"><span class="s">end</span>
</span><span class="line"><span class="s">delete(t1)</span>
</span><span class="line"><span class="s">delete(t2)</span>
</span><span class="line"><span class="s">delete(slow)</span>
</span><span class="line"><span class="s">set(quit,&#39;string&#39;,&#39;close&#39;,&#39;callback&#39;,&#39;close(gcf)&#39;,&#39;value&#39;,0)</span>
</span><span class="line">
</span><span class="line"><span class="s">%------------------------</span>
</span><span class="line">
</span><span class="line"><span class="s">function h = hashfun(url)</span>
</span><span class="line"><span class="s">% Almost unique numeric hash code for pages already visited.</span>
</span><span class="line"><span class="s">h = length(url) + 1024*sum(url);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="mapreducepagerank">4.MapReduce框架下PageRank算法的实现</h3>

<p>利用前面wiki上的迭代(或者幂法)的思想来实现MapReduce框架下PageRank算法很简单，可以先阅读下参考内容5。</p>

<p>这篇文章<a href="http://michaelnielsen.org/blog/using-mapreduce-to-compute-pagerank/">using-mapreduce-to-compute-pagerank</a>更加详细，可以参考</p>

<p>以下是我的大数据的一次作业，要求是参考wiki上的简便算法，实现MapReduce框架下的PageRank算法。给的数据集是Twitter的用户之间的关系，可以看做是网页之间的关系，但是助教没要求写代码以及运行这个数据集(有1G多)，所以下面只是一个Python版本的理想可行版本，并没有通过实际大数据集的验证，另外，博主暂时还不太会Python的mapreduce框架中的一些函数，所以实现的是一个简明的可以测试的PageRank算法。</p>

<h4 id="section-2">1.输入输出格式</h4>

<p><strong>map函数的输入是&lt;节点，从该节点引出的边列表&gt;，其中节点是一个类，包含了其当前的pagerank值，输出是&lt;节点，反向节点pagerank值/反向节点引出边的总数&gt;；</strong></p>

<p><strong>reduce函数的输入是&lt;节点，反向节点pagerank值/反向节点引出边的总数&gt;，输出是&lt;节点，从该节点引出的边列表&gt;，其中节点包含了其更新后的pagerank值。</strong></p>

<p>伪代码： [一时犯二写了个英文形式的 ]</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">process</span> <span class="n">the</span> <span class="n">data</span> <span class="n">to</span> <span class="n">the</span> <span class="n">form</span> <span class="n">of</span> <span class="p">{</span><span class="n">node</span> <span class="n">i</span><span class="p">:[</span><span class="n">its</span> <span class="n">adjacent</span> <span class="n">node</span> <span class="nb">list</span><span class="p">],</span><span class="o">...</span><span class="p">}</span>
</span><span class="line"><span class="k">while</span> <span class="n">the</span> <span class="nb">sum</span> <span class="n">of</span> <span class="n">difference</span> <span class="n">between</span> <span class="n">the</span> <span class="n">last</span> <span class="n">two</span> <span class="n">pagerank</span> <span class="n">values</span> <span class="o">&lt;</span> <span class="n">threshold</span>
</span><span class="line">	<span class="nb">map</span><span class="p">({</span><span class="n">node</span> <span class="n">i</span><span class="p">:[</span><span class="n">its</span> <span class="n">adjacent</span> <span class="n">node</span> <span class="nb">list</span><span class="p">],</span><span class="o">...</span><span class="p">}):</span>
</span><span class="line">	    <span class="n">map_output</span><span class="o">=</span><span class="p">{}</span>
</span><span class="line">	    <span class="k">for</span> <span class="n">every</span> <span class="n">node</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">adjacent</span> <span class="n">node</span> <span class="nb">list</span><span class="p">:</span>
</span><span class="line">	        <span class="n">put</span> <span class="ow">or</span> <span class="nb">sum</span> <span class="n">up</span> <span class="p">{</span><span class="n">j</span><span class="p">:(</span><span class="n">i</span><span class="p">,</span> <span class="n">PageRank</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">length</span><span class="p">(</span><span class="n">adjacent</span> <span class="n">node</span> <span class="nb">list</span><span class="p">))}</span> <span class="n">into</span> <span class="n">map_output</span>
</span><span class="line">	    <span class="k">return</span> <span class="n">map_output</span>
</span><span class="line">	
</span><span class="line">	<span class="nb">reduce</span><span class="p">(</span><span class="n">map_output</span><span class="p">):</span>
</span><span class="line">	    <span class="n">reduce_output</span><span class="o">=</span><span class="p">{}</span>
</span><span class="line">	    <span class="k">for</span> <span class="n">every</span> <span class="n">entry</span> <span class="p">{</span><span class="n">j</span><span class="p">:(</span><span class="n">i</span><span class="p">,</span> <span class="n">PageRank</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="n">length</span><span class="p">(</span><span class="n">adjacent</span> <span class="n">node</span> <span class="nb">list</span><span class="p">))}</span> <span class="ow">in</span> <span class="n">map_output</span><span class="p">:</span>
</span><span class="line">	        <span class="n">put</span> <span class="ow">or</span> <span class="nb">sum</span> <span class="n">up</span> <span class="nb">all</span> <span class="n">values</span> <span class="n">pagerank</span> <span class="n">values</span> <span class="k">for</span> <span class="n">node</span> <span class="n">j</span> <span class="k">with</span> <span class="n">its</span> <span class="n">adjacent</span> <span class="n">node</span> <span class="nb">list</span> <span class="n">into</span> <span class="n">reduce_output</span>
</span><span class="line">	    <span class="k">return</span> <span class="n">reduce_output</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h4 id="section-3">2.示例演示</h4>

<p>假设用户1，2，3，4是如下图所示的关系：</p>

<p><img src="http://hujiaweibujidao.github.io/images/others/pagerankdemo.png" alt="image" /></p>

<p>假设有2个mapper(A和B)和1个reducer(C)，初始时4个节点的pagerank值都是0.25</p>

<p>其中，关于用户1和2的数据被mapperA读取并处理，关于用户3和4的数据被mapperB读取并处理 [经验证，即使一个用户的数据是由不同的mapper来读取的，最终收敛到的结果差不多]</p>

<p>map的输入输出结果如下：</p>

<p><img src="http://hujiaweibujidao.github.io/images/others/mapper.png" alt="image" /></p>

<p>reduce的输入输出结果如下，输入是2个mapper的输出，输出的结果中更新了节点的pagerank值</p>

<p><img src="http://hujiaweibujidao.github.io/images/others/reducer.png" alt="image" /></p>

<p>reducer处理完了之后又将它的结果输入给mapper处理，直到迭代的次数超过了设定值或者两次迭代之后得到的所有节点的pagerank值之差的总和(也可以是取二范数)小于设定的阈值。</p>

<h4 id="section-4">3.示例的实验结果</h4>

<p>(1)首先是使用Matlab采用幂法的方式计算出在p=1.0的情况下示例得到的结果 [它的主要作用是验证后面python版本的正确性]</p>

<p>matlab源码如下：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">n</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span>
</span><span class="line"><span class="n">i</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">4</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">];</span>
</span><span class="line"><span class="n">j</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">];</span>
</span><span class="line"><span class="n">G</span><span class="o">=</span><span class="n">sparse</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="p">[</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>
</span><span class="line"><span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">n</span>
</span><span class="line">   <span class="n">L</span><span class="p">{</span><span class="n">j</span><span class="p">}</span> <span class="o">=</span> <span class="n">find</span><span class="p">(</span><span class="n">G</span><span class="p">(:,</span><span class="n">j</span><span class="p">));</span>
</span><span class="line">   <span class="n">c</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">length</span><span class="p">(</span><span class="n">L</span><span class="p">{</span><span class="n">j</span><span class="p">});</span>
</span><span class="line"><span class="n">end</span>
</span><span class="line">
</span><span class="line"><span class="o">%</span> <span class="n">Power</span> <span class="n">method</span>
</span><span class="line"><span class="n">p</span><span class="o">=</span><span class="mf">1.0</span><span class="p">;</span>
</span><span class="line"><span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
</span><span class="line"><span class="n">x</span> <span class="o">=</span> <span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
</span><span class="line"><span class="n">z</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class="line"><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="k">while</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">z</span><span class="p">))</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mo">0001</span>
</span><span class="line">   <span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span><span class="line">   <span class="n">x</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class="line">   <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">n</span>
</span><span class="line">      <span class="k">if</span> <span class="n">c</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class="line">         <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">n</span><span class="p">;</span>
</span><span class="line">      <span class="k">else</span>
</span><span class="line">         <span class="n">x</span><span class="p">(</span><span class="n">L</span><span class="p">{</span><span class="n">j</span><span class="p">})</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="n">L</span><span class="p">{</span><span class="n">j</span><span class="p">})</span> <span class="o">+</span> <span class="n">z</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span><span class="line">      <span class="n">end</span>
</span><span class="line">   <span class="n">end</span>
</span><span class="line">   <span class="n">x</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">delta</span><span class="p">;</span>
</span><span class="line">   <span class="n">cnt</span> <span class="o">=</span> <span class="n">cnt</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class="line"><span class="n">end</span>
</span><span class="line"><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;pagerank result:&#39;</span><span class="p">)</span>
</span><span class="line"><span class="n">x</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>结果为：</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="mf">0.1072</span>
</span><span class="line"><span class="mf">0.3571</span>
</span><span class="line"><span class="mf">0.2143</span>
</span><span class="line"><span class="mf">0.3214</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>(2)matlab版本的page rank没有采用mapreduce的思想进行迭代，所以我另外写了一个python版本的利用mapreduce思想实现的pagerank算法(注：我并没有使用python的map和reduce函数去实现，而是使用更加容易明白的实现)，使用的阈值为0.0001，最多迭代的次数为100次。</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="c"># coding=utf-8</span>
</span><span class="line">
</span><span class="line"><span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;hujiawei&#39;</span>
</span><span class="line"><span class="n">__doc__</span> <span class="o">=</span> <span class="s">&#39;pagerank mapreduce&#39;</span>
</span><span class="line">
</span><span class="line"><span class="k">class</span> <span class="nc">Node</span><span class="p">:</span>
</span><span class="line">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">pk</span><span class="p">):</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">=</span><span class="nb">id</span>
</span><span class="line">        <span class="bp">self</span><span class="o">.</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">pk_map</span><span class="p">(</span><span class="n">map_input</span><span class="p">):</span>
</span><span class="line">    <span class="n">map_output</span><span class="o">=</span><span class="p">{}</span>
</span><span class="line">    <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">outlinks</span> <span class="ow">in</span> <span class="n">map_input</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class="line">        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">outlinks</span><span class="p">:</span>
</span><span class="line">            <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">outlinks</span><span class="p">)</span>
</span><span class="line">            <span class="k">if</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">map_output</span><span class="p">:</span>
</span><span class="line">                <span class="n">map_output</span><span class="p">[</span><span class="n">link</span><span class="p">]</span><span class="o">+=</span><span class="p">(</span><span class="nb">float</span><span class="p">)(</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">/</span><span class="n">size</span>
</span><span class="line">            <span class="k">else</span><span class="p">:</span>
</span><span class="line">                <span class="n">map_output</span><span class="p">[</span><span class="n">link</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">)(</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">/</span><span class="n">size</span>
</span><span class="line">    <span class="k">return</span> <span class="n">map_output</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">pk_reduce</span><span class="p">(</span><span class="n">reduce_input</span><span class="p">):</span>
</span><span class="line">    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">reduce_input</span><span class="p">:</span>
</span><span class="line">        <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class="line">            <span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="o">+=</span><span class="n">value</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">pk_clear</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
</span><span class="line">    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span class="line">        <span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="o">=</span><span class="mi">0</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">pk_last</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
</span><span class="line">    <span class="n">lastnodes</span><span class="o">=</span><span class="p">[]</span>
</span><span class="line">    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span class="line">        <span class="n">lastnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Node</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
</span><span class="line">    <span class="k">return</span> <span class="n">lastnodes</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">pk_diff</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">lastnodes</span><span class="p">):</span>
</span><span class="line">    <span class="n">diff</span><span class="o">=</span><span class="mi">0</span>
</span><span class="line">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)):</span>
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="s">&#39;node pk </span><span class="si">%f</span><span class="s">, last node pk </span><span class="si">%f</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">,</span> <span class="n">lastnodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">))</span>
</span><span class="line">        <span class="n">diff</span><span class="o">+=</span><span class="nb">abs</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="o">-</span><span class="n">lastnodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</span><span class="line">    <span class="k">return</span> <span class="n">diff</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">pk_test1</span><span class="p">():</span>
</span><span class="line">    <span class="n">node1</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span class="line">    <span class="n">node2</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span class="line">    <span class="n">node3</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span class="line">    <span class="n">node4</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span class="line">    <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">,</span> <span class="n">node4</span><span class="p">]</span>
</span><span class="line">    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.0001</span>
</span><span class="line">    <span class="n">max_iters</span> <span class="o">=</span> <span class="mi">100</span>
</span><span class="line">
</span><span class="line">    <span class="k">for</span> <span class="n">iter_count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iters</span><span class="p">):</span>
</span><span class="line">        <span class="n">iter_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class="line">        <span class="n">lastnodes</span><span class="o">=</span><span class="n">pk_last</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="s">&#39;============ map count </span><span class="si">%d</span><span class="s"> =================&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iter_count</span><span class="p">))</span>
</span><span class="line">        <span class="n">in1</span> <span class="o">=</span> <span class="p">{</span><span class="n">node1</span><span class="p">:</span> <span class="p">[</span><span class="n">node2</span><span class="p">,</span> <span class="n">node3</span><span class="p">,</span> <span class="n">node4</span><span class="p">],</span> <span class="n">node2</span><span class="p">:</span> <span class="p">[</span><span class="n">node3</span><span class="p">,</span> <span class="n">node4</span><span class="p">]}</span>
</span><span class="line">        <span class="n">in2</span> <span class="o">=</span> <span class="p">{</span><span class="n">node3</span><span class="p">:</span> <span class="p">[</span><span class="n">node1</span><span class="p">,</span> <span class="n">node4</span><span class="p">],</span> <span class="n">node4</span><span class="p">:</span> <span class="p">[</span><span class="n">node2</span><span class="p">]}</span>
</span><span class="line">
</span><span class="line">        <span class="n">mapout1</span> <span class="o">=</span> <span class="n">pk_map</span><span class="p">(</span><span class="n">in1</span><span class="p">)</span>
</span><span class="line">        <span class="n">mapout2</span> <span class="o">=</span> <span class="n">pk_map</span><span class="p">(</span><span class="n">in2</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mapout1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class="line">            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mapout2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span class="line">            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">print</span><span class="p">(</span><span class="s">&#39;============ reduce count </span><span class="si">%d</span><span class="s"> =================&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">iter_count</span><span class="p">))</span>
</span><span class="line">
</span><span class="line">        <span class="n">reducein</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapout1</span><span class="p">,</span> <span class="n">mapout2</span><span class="p">]</span>
</span><span class="line">        <span class="n">pk_clear</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
</span><span class="line">        <span class="n">pk_reduce</span><span class="p">(</span><span class="n">reducein</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
</span><span class="line">            <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">        <span class="n">diff</span><span class="o">=</span><span class="n">pk_diff</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">lastnodes</span><span class="p">)</span>
</span><span class="line">        <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
</span><span class="line">            <span class="k">break</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class="line">    <span class="n">pk_test1</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>得到的结果为如下，总共迭代了15次</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="mi">1</span> <span class="mf">0.107138774577</span>
</span><span class="line"><span class="mi">2</span> <span class="mf">0.35712924859</span>
</span><span class="line"><span class="mi">3</span> <span class="mf">0.214296601128</span>
</span><span class="line"><span class="mi">4</span> <span class="mf">0.321435375705</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>上面的结果和Matlab用幂法得到的pagerank值差别很小，可以认为是正确的，所以说明了使用这种mapreduce输入输出格式的正确性。</p>

<p>OK，差不多了，希望对需要理解PageRank算法的人有帮助！ :-) </p>

<p class="post-footer">
                        Original link:<a href="http://hujiaweibujidao.github.io/blog/2014/05/12/algorithms-pagerank/">http://hujiaweibujidao.github.io/blog/2014/05/12/algorithms-pagerank/</a><br />Written by <a href="http://hujiaweibujidao.github.io">hujiawei</a>&nbsp;Posted at <a href="http://hujiaweibujidao.github.io">http://hujiaweibujidao.github.io</a><br />Feel free to read or comment it, and if you want to copy it into your own site, please copy it with its Original Link showed above or you can see the license below for more details.<br />Thanks a lot. Hope you enjoy here! :-)</p>
</div>


		<footer>
			<p class="meta">
				
  

<span class="byline author vcard">Posted by <span class="fn">hujiawei</span></span>

				








  


<time datetime="2014-05-12T18:12:00+08:00" pubdate data-updated="true">May 12<span>th</span>, 2014</time>
				

<span class="categories">
  
    <a class='category' href='/blog/categories/algorithm/'>algorithm</a>
  
</span>


			</p>
			
			<div class="sharing">
  
  
  
</div>

			
			<p class="meta">
				
				<a class="basic-alignment left" href="/blog/2014/05/10/happy-mothers-day/" title="Previous Post: Happy Mother's Day">&laquo; Happy Mother's Day</a>
				
				
				<a class="basic-alignment right" href="/blog/2014/05/12/hadoop-installation/" title="Next Post: Hadoop Installation - Single Node Setup">Hadoop Installation - Single Node Setup &raquo;</a>
				
			</p>
		</footer>
	</article>
	

	
	<section>
		<h1>Comments</h1>
		<div id="comments" aria-live="polite">
			<!-- Duoshuo Comment BEGIN   data-title=""-->
<div class="ds-thread"></div>
<script type="text/javascript">
  var duoshuoQuery = {short_name:"hujiaweibujidao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script>
<!-- Duoshuo Comment END -->

		</div>
	</section>
	
</div>

<aside class="sidebar">
  
	<section>
	<h1>关于博主</h1><br/>
  <a href="/aboutme/"><img src="/images/me-small.png" width="250px" height="210px" alt="protrait"/></a><br/>
  <p>Hi, I'm Hujiawei, from P.R.China. Now I'm a postgraduate student studying in <a href="http://www.tsinghua.edu.cn/publish/th/index.html">Tsinghua University</a>.
  Wanna know me? <a href="/aboutme/">See here.</a> 
  </p>
  
  <img src="/images/conan-mainperson.png" width="250px" height="210px" alt="conan"/>
  
  <br/>
  
    <a href="http://weibo.com/hujiaweiyinger"><img src="/images/sinaweibo.png" width="40px" height="40px"/></a> &nbsp;
  <a href="https://github.com/hujiaweibujidao"><img src="/images/github.png" width="40px" height="40px"/></a>&nbsp;
  <a href="http://hujiawei.tumblr.com"><img src="/images/tumblr.png" width="40px" height="40px"/></a> &nbsp;
  <a href="https://twitter.com/hujiaweiyinger"><img src="/images/twitter.png" width="40px" height="40px"/></a>&nbsp;
  <a href="http://www.douban.com/people/60272837/"><img src="/images/douban.png" width="40px" height="40px"/></a>
 
 <br/>
    
    <!--autoplay="autoplay" -->
    <!--
<audio width="200" height="32" 
style="margin: auto; top: 0; right: 0; bottom: 0; left: 0;" 
controls="controls" 
name="media" 
src="http://hujiaweibujidao.github.io/music/Wouldnt-It-Be-Nice.mp3">
</audio>
-->
  
  
  <!--baidu-->
  <!--
  <div class="bdsharebuttonbox"><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a><a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>  
-->

</section>
<section>
 <h1>分类目录</h1>
 <ul id="categories">
	 <li class='category'><a href='/blog/categories/algorithm/'>algorithm (10)</a></li>
<li class='category'><a href='/blog/categories/android/'>android (5)</a></li>
<li class='category'><a href='/blog/categories/hadoop/'>hadoop (1)</a></li>
<li class='category'><a href='/blog/categories/ios/'>ios (1)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/math/'>math (17)</a></li>
<li class='category'><a href='/blog/categories/matlab/'>matlab (1)</a></li>
<li class='category'><a href='/blog/categories/mobiledev/'>mobiledev (5)</a></li>
<li class='category'><a href='/blog/categories/music/'>music (2)</a></li>
<li class='category'><a href='/blog/categories/octopress/'>octopress (4)</a></li>
<li class='category'><a href='/blog/categories/opencv/'>opencv (5)</a></li>
<li class='category'><a href='/blog/categories/picture/'>picture (1)</a></li>
<li class='category'><a href='/blog/categories/python/'>python (2)</a></li>

 </ul>
</section>
<section>
  <h1>近期文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/18/love-you/">Love You</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/16/python-tips2/">Python Advances</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/12/hadoop-installation/">Hadoop Installation - Single Node Setup</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/12/algorithms-pagerank/">Algorithms-PageRank</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/10/happy-mothers-day/">Happy Mother's Day</a>
      </li>
    
  </ul>
</section>
<section>
	<h1>好友博客</h1>
	<ul>
		<li>
			<a href="http://doufunao.github.io/">豆腐脑的幻想乡</a>
		</li>
		<li>
			<a href="http://c4fun.cn/">Code 4 Fun</a>
		</li>
		<li>
			<a href="http://www.tanglei.name/">TangLei blog</a>
		</li>
		<li>
			<a href="http://ontheroad.sinaapp.com/">Tian Jun-Find My Way</a>
		</li>
		
		<li>
			<a href="http://www.liaoxuefeng.com/">廖雪峰的官方网站</a>
		</li>
		<li>
			<a href="http://wufawei.com/">Ted's Homepage</a>
		</li>
		<li>
			<a href="http://www.renfei.org/blog/">Renfei Song</a>
		</li>
		<li>
			<a href="http://bluedavy.me">BlueDavy之技术blog</a>
		</li>
		
		<li>
			<a href="#">这里会是你吗?</a>
		</li>
	</ul>
</section>
	
</aside>


		</div>
	</div>
	
	<footer role="contentinfo">
		<p>
  	Copyright &copy; 2014 - hujiawei - <a href="http://hujiaweibujidao.github.io/happybirthday/">Happy birthday to MY QUEEN</a> - <span class="credit">Proudly Powered by <a href="http://octopress.org">Octopress</a></span>
  	
<!-- mathjax config similar to math.stackexchange  -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

<!-- the following line is incorrect! -->
<!--
<script type="text/javascript" src="https://stackedit.io/libs/MathJax/MathJax.js?config=TeX-AMS_HTML"></script>
-->

<!--baidu-->
<!--
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"1","bdPos":"left","bdTop":"250"}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
-->

	<!-- CNZZ -->
	&nbsp;&nbsp;
	<script type="text/javascript">
		var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
		document.write(unescape("%3Cspan id='cnzz_stat_icon_1000165127'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s22.cnzz.com/z_stat.php%3Fid%3D1000165127%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
	</script>
	
	<!--baidu share-->
	<!--
	<div class="bdsharebuttonbox" style="display: inline;"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
	-->
	<!-- license -->
	<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/deed.zh"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nd/3.0/88x31.png" /></a>
	本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nd/3.0/deed.zh">知识共享署名-禁止演绎 3.0 未本地化版本许可协议</a>进行许可。

</p>

<!--hujiawei custom blockquote-->
<!--for block quote
<style>
blockquote{
	font:inherit;
	font-size:60%;
	font-style:normal;
	line-height:1.0em;
	color:rgba(0,0,0,0.5);
}
</style>-->

<!-- gutter for code line-numbers!! -->
<!--for block quote-->
<!--
<style>
blockquote{
	font:inherit;
	font-size:60%;
	font-style:normal;
	line-height:1.0em;
	color:rgba(0,0,0,0.5);
}

.gutter{
	display: none;
}

.highlight, .gist-highlight {
margin-bottom: 1.8em;
background: #002b36;
overflow-y: hidden;
overflow-x: auto;
}
</style>
-->

<!--return to top-->
<style>
	.returnTop {
		position: fixed;
		_position: absolute;
		right: 10px;
		bottom: 200px;
		_bottom: auto;
		display: none;
		width: 40px;
		height: 40px;
		border: 1px solid #61b72e;
		border-radius: 4px;
		background: #fff;
		box-shadow: 0 0 5px #F5F5F5;
		text-indent: -9999px;
		cursor: pointer;
	}
	.returnTop .s {
		position: absolute;
		top: -2px;
		_top: -20px;
		left: 10px;
		width: 0;
		height: 0;
		border-width: 10px;
		border-color: transparent transparent #61b72e;
		border-style: dashed dashed solid;
	}
	.returnTop .b {
		position: absolute;
		top: 18px;
		left: 16px;
		height: 12px;
		width: 8px;
		background: #61b72e;
	}
</style>
<div class="returnTop" title="嗖的就上去了！">
	<span class="s"></span>
	<span class="b"></span>
	返回顶部
</div>
<script type="text/javascript">
$(function(){
$(window).bind("scroll", function(){

var scrollTopNum = $(document).scrollTop(),
winHeight = $(window).height(),
returnTop = $("div.returnTop");

(scrollTopNum > 0) ? returnTop.fadeIn("fast") : returnTop.fadeOut("fast");

if (!-[1,]&&!window.XMLHttpRequest) {
returnTop.css("top", scrollTopNum + winHeight - 200);
}

});

$("div.returnTop").click(function() {
$("html, body").animate({ scrollTop: 0 }, 100);
});

});
</script>

	</footer>
	
	













</body>
</html>
